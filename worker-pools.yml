---
# This file contains definitions for the worker pools related to Firefox CI.
#
# Each worker pool is named by its <provisionerId>/<workerType> pair, each with
# the following structure (matching that for taskcluster-worker-manager):
#
# - `description` -- description of this workerType
# - `owner` -- owner of this workerType
# - `email_on_error` -- if true, email the owner on provisioning errors
# - `provider_id` -- the worker-manager provider for this worker pool
# - `config` -- the configuration for this worker pool, specific to the provider type
#
# A top-level `image` property in the config will be interpreted by fxci-config and
# translated into a region[..].launchSpec.ImageId value based on worker-pools.yml.
worker-defaults:
  lifecycle:
    queueInactivityTimeout: 7200
    registrationTimeout: 1800
    reregistrationTimeout: 345600
  worker-config:
    by-implementation:
      docker-worker:
        shutdown:
          enabled: true
          afterIdleSeconds: 120
        deviceManagement:
          hostSharedMemory: {enabled: false}
          kvm: {enabled: false}
        artifacts:
          # FIXME: remove after workers are updated to >= 45.0.1
          skipCompressionExtensions:
            - .7z
            - .bz2
            - .deb
            - .dmg
            - .flv
            - .gif
            - .gz
            - .jpeg
            - .jpg
            - .png
            - .swf
            - .tbz
            - .tgz
            - .webp
            - .whl
            - .woff
            - .woff2
            - .xz
            - .zip
            - .zst
            - lz4
      generic-worker/windows:
        genericWorker:
          config:
            idleTimeoutSecs: 90
            cachesDir: Z:\caches
            cleanUpTaskDirs: true
            deploymentId: f37dd7ee1cae
            disableReboots: false
            downloadsDir: Z:\downloads
            ed25519SigningKeyLocation: C:\generic-worker\ed25519-private.key
            livelogExecutable: C:\generic-worker\livelog.exe
            livelogPUTPort: 60022
            numberOfTasksToRun: 0
            runAfterUserCreation: C:\generic-worker\task-user-init.cmd
            runTasksAsCurrentUser: false
            sentryProject: generic-worker
            shutdownMachineOnIdle: true
            shutdownMachineOnInternalError: true
            taskclusterProxyExecutable: C:\generic-worker\taskcluster-proxy.exe
            taskclusterProxyPort: 80
            tasksDir: Z:\
            wstAudience: firefoxcitc
      generic-worker/worker-runner-windows:
        genericWorker:
          config:
            cachesDir: Z:\caches
            cleanUpTaskDirs: true
            disableReboots: false
            downloadsDir: Z:\downloads
            livelogExecutable: C:\generic-worker\livelog.exe
            ed25519SigningKeyLocation: C:\generic-worker\ed25519-private.key
            idleTimeoutSecs: 150
            numberOfTasksToRun: 0
            runAfterUserCreation: C:\generic-worker\task-user-init.cmd
            runTasksAsCurrentUser: false
            sentryProject: generic-worker
            shutdownMachineOnIdle: true
            shutdownMachineOnInternalError: true
            taskclusterProxyExecutable: C:\generic-worker\taskcluster-proxy.exe
            taskclusterProxyPort: 80
            tasksDir: Z:\
            wstAudience: firefoxcitc
      generic-worker/worker-runner-linux:
        genericWorker:
          config:
            cachesDir: /home/ubuntu/caches
            cleanUpTaskDirs: true
            disableReboots: false
            downloadsDir: /home/ubuntu/downloads
            livelogExecutable: /home/ubuntu/generic_worker/livelog
            ed25519SigningKeyLocation: /home/ubuntu/generic_worker/ed25519-private.key
            # This timeout is set very low to avoid burning money on the GPU instances
            # that use this configuration. If other pools need a different idle timeout
            # we should probably split this at some point.
            idleTimeoutSecs: 300  # 5 minutes
            numberOfTasksToRun: 0
            sentryProject: generic-worker
            shutdownMachineOnIdle: true
            shutdownMachineOnInternalError: true
            taskclusterProxyExecutable: /home/ubuntu/generic_worker/taskcluster-proxy
            taskclusterProxyPort: 8081
            tasksDir: /home/ubuntu/tasks
            wstAudience: firefoxcitc
      generic-worker/worker-runner-linux-multi:  # for images built with monopacker 22.04 community configuration
        genericWorker:
          config:
            cleanUpTaskDirs: true
            disableReboots: false
            ed25519SigningKeyLocation: /etc/taskcluster/secrets/gw_cot_private_key
            idleTimeoutSecs: 300  # 5 minutes
            livelogExecutable: /usr/local/bin/livelog
            numberOfTasksToRun: 0
            sentryProject: generic-worker
            shutdownMachineOnIdle: true
            shutdownMachineOnInternalError: true
            taskclusterProxyExecutable: /usr/local/bin/taskcluster-proxy
            taskclusterProxyPort: 80
            wstAudience: firefoxcitc

meta:
  - &persistent-disk
    autoDelete: true
    boot: true
    initializeParams:
      sourceImage: <image>
    type: PERSISTENT
  - &scratch-disk
    autoDelete: true
    initializeParams:
      diskType: diskTypes/local-ssd
    type: SCRATCH
    interface: NVME

pools:
  - pool_id: infra/build-decision
    description: Worker for firefox-ci automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    config:
      minCapacity: 1
      maxCapacity: 4
      regions: [us-central1, us-west1]
      image: monopacker-docker-worker-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
            - *scratch-disk
          machine_type: n2-standard-2
          capacityPerInstance: 8
      worker-config:
        shutdown:
          afterIdleSeconds: 86400
  - pool_id: '{pool-group}/b-linux-gcp'
    description: Worker for Firefox automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: gecko-1
      - pool-group: gecko-2
      - pool-group: gecko-3
        chain-of-trust: trusted
      - pool-group: comm-1
      - pool-group: comm-2
      - pool-group: comm-3
        chain-of-trust: trusted
      - pool-group: app-services-1
      - pool-group: app-services-3
        chain-of-trust: trusted
      - pool-group: mozillaonline-1
      - pool-group: mozillaonline-3
        chain-of-trust: trusted
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          gecko-.*: 1000
          comm-.*: 300
          app-services-1: 50
          app-services-3: 100
          mozillaonline-.*: 10
          default: 100
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 20
            - *scratch-disk
            - *scratch-disk
          machine_type: c2-standard-16
  - pool_id: '{pool-group}/b-linux-gcp-test-bug-1882320'
    description: Worker for Firefox automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: gecko-1
    provider_id: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 5
      regions: [northamerica-northeast1]
      image: monopacker-docker-worker-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 20
            - *scratch-disk
            - *scratch-disk
          machine_type: c2-standard-16
  - pool_id: '{pool-group}/b-linux-gcp-aarch64'
    description: Linux ARM64 VM for Firefox automation.
    owner: release+tc-workers@mozilla.com
    variants:
      - pool-group: gecko-1
      - pool-group: gecko-2
      - pool-group: gecko-3
        chain-of-trust: trusted
    email_on_error: true
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          gecko-.*: 10
      implementation: generic-worker/worker-runner-linux-multi
      # the "t2a" machine series is only available in the "a", "b", and "f" zones of the "us-central1" region.
      regions: [us-central1]
      image: monopacker-ubuntu-2204-wayland-arm64
      instance_types:
        - minCpuPlatform: Ampere Altra
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
          machine_type: t2a-standard-16
  - pool_id: '{pool-group}/b-linux{suffix}'
    description: Worker for Firefox automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    attributes:
      suffix: "-gcp"
      implementation: "docker-worker"
    variants:
      - pool-group: glean-1
      - pool-group: glean-3
        chain-of-trust: trusted
      - pool-group: mobile-1
      - pool-group: mobile-3
        chain-of-trust: trusted
      - pool-group: mozilla-1
      - pool-group: mozilla-3
        chain-of-trust: trusted
      - pool-group: mozillavpn-1
      - pool-group: mozillavpn-1
        suffix: "-gcp-gw"
        implementation: generic-worker/worker-runner-linux-multi
      - pool-group: mozillavpn-3
        chain-of-trust: trusted
      - pool-group: mozillavpn-3
        suffix: "-gcp-gw"
        implementation: generic-worker/worker-runner-linux-multi
        chain-of-trust: trusted
      - pool-group: adhoc-1
      - pool-group: adhoc-3
        chain-of-trust: trusted
      - pool-group: scriptworker-1
      - pool-group: scriptworker-3
        chain-of-trust: trusted
      - pool-group: xpi-1
      - pool-group: xpi-3
        chain-of-trust: trusted
      - pool-group: releng-1
      - pool-group: releng-3
        chain-of-trust: trusted
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          mobile-.*: 50
          mozilla-.*: 10
          mozillavpn-.*: 10
          default: 100
      regions: [us-central1, us-west1]
      image:
        by-implementation:
          docker-worker:
            by-chain-of-trust:
              trusted: monopacker-docker-worker-trusted-current-gcp
              default: monopacker-docker-worker-current
          generic-worker/.*: monopacker-ubuntu-2204-wayland
      implementation: "{implementation}"
      instance_types:
        by-implementation:
          # Scratch disks aren't configured on generic-worker images yet.
          generic-worker/.*:
            - minCpuPlatform: Intel Cascadelake
              disks:
                - <<: *persistent-disk
                  diskSizeGb: 60
              machine_type: c2-standard-4
          default:
            - minCpuPlatform: Intel Cascadelake
              disks:
                - <<: *persistent-disk
                  diskSizeGb: 20
                - *scratch-disk
              machine_type: c2-standard-4
  - pool_id: '{pool-group}/b-linux-large{suffix}'
    description: Worker for Firefox automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    attributes:
      suffix: "-gcp"
      implementation: "docker-worker"
    variants:
      - pool-group: gecko-1
      - pool-group: gecko-2
      - pool-group: gecko-3
        chain-of-trust: trusted
      - pool-group: comm-1
      - pool-group: comm-2
      - pool-group: comm-3
        chain-of-trust: trusted
      - pool-group: mozillavpn-1
      - pool-group: mozillavpn-3
        chain-of-trust: trusted
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          gecko-.*: 1000
          comm-.*: 20
          default: 10
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      implementation: "{implementation}"
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 20
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
          machine_type: n2-custom-32-73728
  - pool_id: '{pool-group}/b-linux-large-gcp-d2g'
    description: Workers using generic-worker on Linux with D2G capability.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: translations-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 1000
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: monopacker-ubuntu-2204-wayland
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 60
          machine_type: n2-custom-32-262144
  - pool_id: '{pool-group}/b-linux-large-gcp-d2g-1tb'
    description: Big workers with big disks - intended for Firefox Translations only
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: translations-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 1000
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: monopacker-ubuntu-2204-wayland
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 1024
          machine_type: n2-custom-32-262144
  - pool_id: '{pool-group}/b-linux-large-gcp-d2g-1tb-standard'
    description: Big workers with big disks - intended for Firefox Translations only
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: translations-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 1000
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: monopacker-ubuntu-2204-wayland
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 1024
          machine_type: n2-custom-32-262144
          scheduling: standard
  - pool_id: '{pool-group}/b-linux-large-gcp-d2g-300gb'
    description: Big workers with big disks - intended for Firefox Translations only
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: translations-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 1000
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: monopacker-ubuntu-2204-wayland
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 300
          machine_type: n2-custom-32-262144
  - pool_id: '{pool-group}/b-linux-large-gcp'
    description: Worker for Firefox Translations automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: translations-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 1000
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 20
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
          machine_type: n2-custom-32-262144
  - pool_id: '{pool-group}/b-linux-large-gcp-1tb-32-256-d2g'
    description: Preemptible VM workers with 1 TB of disk space, 32 vCPUs, and 256 GiB of RAM. Intended for Firefox Translations only.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: translations-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 1000
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: monopacker-ubuntu-2204-wayland
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 1024
          machine_type: n2-custom-32-262144
  - pool_id: '{pool-group}/b-linux-large-gcp-1tb-32-256-std-d2g'
    description: Standard VM workers with 1 TB of disk space, 32 vCPUs, and 256 GiB of RAM. Intended for Firefox Translations only.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: translations-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 16
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: monopacker-ubuntu-2204-wayland
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 1024
          machine_type: n2-custom-32-262144
          scheduling: standard
  - pool_id: '{pool-group}/b-linux-large-gcp-1tb-64-512-d2g'
    description: Preemptible VM workers with 1 TB of disk space, 64 vCPUs, and 512 GiB of RAM. Intended for Firefox Translations only.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: translations-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 1000
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: monopacker-ubuntu-2204-wayland
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 1024
          machine_type: n2-custom-64-524288
  - pool_id: '{pool-group}/b-linux-large-gcp-1tb-64-512-std-d2g'
    description: Standard VM workers with 1 TB of disk space, 64 vCPUs, and 512 GiB of RAM. Intended for Firefox Translations only.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: translations-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 8
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: monopacker-ubuntu-2204-wayland
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 1024
          machine_type: n2-custom-64-524288
          scheduling: standard
  - pool_id: '{pool-group}/b-linux-large-gcp-1tb-32-256'
    description: Preemptible VM workers with 1 TB of disk space, 32 vCPUs, and 256 GiB of RAM. Intended for Firefox Translations only.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: translations-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 1000
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 1024
          machine_type: n2-custom-32-262144
  - pool_id: '{pool-group}/b-linux-large-gcp-1tb-32-256-standard'
    description: Standard VM workers with 1 TB of disk space, 32 vCPUs, and 256 GiB of RAM. Intended for Firefox Translations only.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: translations-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 16
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 1024
          machine_type: n2-custom-32-262144
          scheduling: standard
  - pool_id: '{pool-group}/b-linux-large-gcp-1tb-64-512'
    description: Preemptible VM workers with 1 TB of disk space, 64 vCPUs, and 512 GiB of RAM. Intended for Firefox Translations only.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: translations-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 1000
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 1024
          machine_type: n2-custom-64-524288
  - pool_id: '{pool-group}/b-linux-large-gcp-1tb-64-512-standard'
    description: Standard VM workers with 1 TB of disk space, 64 vCPUs, and 512 GiB of RAM. Intended for Firefox Translations only.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: translations-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 8
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 1024
          machine_type: n2-custom-64-524288
          scheduling: standard
  - pool_id: '{pool-group}/b-linux-large-gcp-300gb'
    description: Big workers with big disks - intended for Firefox Translations only
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: translations-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 1000
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 300
          machine_type: n2-custom-32-262144
  - pool_id: '{pool-group}/b-linux-medium-gcp'
    description: Worker for Firefox automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: gecko-1
      - pool-group: gecko-3
        chain-of-trust: trusted
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          gecko-1: 200
          gecko-3: 100
          default: 10
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 20
            - *scratch-disk
          machine_type: c2-standard-8
  - pool_id: '{pool-group}/b-linux-xlarge-gcp'
    description: Worker for Firefox automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: gecko-1
      - pool-group: gecko-2
      - pool-group: gecko-3
        chain-of-trust: trusted
      - pool-group: comm-1
      - pool-group: comm-2
      - pool-group: comm-3
        chain-of-trust: trusted
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          gecko-.*: 1000
          comm-.*: 20
          default: 10
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 20
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
          machine_type: n2-custom-64-131072
  - pool_id: '{pool-group}/b-linux-xlarge-gcp-bug1797804-c2'
    description: Worker for Firefox automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: gecko-1
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 10
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      instance_types:
        - disks:
            - <<: *persistent-disk
              diskSizeGb: 20
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
            - *scratch-disk
          machine_type: c2-standard-60
  - pool_id: '{pool-group}/decision-gcp'
    description: Worker for Firefox automation
    owner: release+tc-workers@mozilla.com
    email_on_error: false
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    variants:
      - pool-group: gecko-1
      - pool-group: gecko-2
      - pool-group: gecko-3
        chain-of-trust: trusted
      - pool-group: comm-1
      - pool-group: comm-2
      - pool-group: comm-3
        chain-of-trust: trusted
    config:
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      security:
        by-chain-of-trust:
          trusted: trusted
          default:
      minCapacity:
        by-pool-group:
          gecko-[13]: 1
          default: 0
      maxCapacity:
        by-pool-group:
          gecko-1: 40
          gecko-3: 20
          default: 4
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
            - *scratch-disk
          machine_type: c2-standard-4
          capacityPerInstance: 2
      worker-config:
        shutdown:
          afterIdleSeconds:
            by-pool-group:
              gecko-[13]: 600
              default: 120
  - pool_id: '{pool-group}/decision-gcp'
    description: Worker for Firefox automation
    owner: release+tc-workers@mozilla.com
    email_on_error: false
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    variants:
      - pool-group: adhoc-1
      - pool-group: adhoc-3
        chain-of-trust: trusted
      - pool-group: app-services-1
      - pool-group: app-services-3
        chain-of-trust: trusted
      - pool-group: glean-1
      - pool-group: glean-3
        chain-of-trust: trusted
      - pool-group: mozillavpn-1
      - pool-group: mozillavpn-3
        chain-of-trust: trusted
      - pool-group: scriptworker-1
      - pool-group: scriptworker-3
        chain-of-trust: trusted
      - pool-group: xpi-1
      - pool-group: xpi-3
        chain-of-trust: trusted
      - pool-group: ci-1
      - pool-group: ci-3
        chain-of-trust: trusted
      - pool-group: relops-3
        chain-of-trust: trusted
      - pool-group: taskgraph-1
      - pool-group: taskgraph-3
        chain-of-trust: trusted
      - pool-group: releng-1
      - pool-group: releng-3
        chain-of-trust: trusted
      - pool-group: mobile-1
      - pool-group: mobile-3
        chain-of-trust: trusted
      - pool-group: mozilla-1
      - pool-group: mozilla-3
        chain-of-trust: trusted
      - pool-group: translations-1
      - pool-group: nss-1
    config:
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      security:
        by-chain-of-trust:
          trusted: trusted
          default:
      minCapacity:
        by-pool-group:
          '(app-services|glean|mozillavpn|mobile|mozilla)-1': 1
          default: 0
      maxCapacity: 10
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
            - *scratch-disk
          machine_type: n2-standard-2
          capacityPerInstance: 2
      worker-config:
        shutdown:
          afterIdleSeconds:
            by-pool-group:
              '(app-services|glean|mozillavpn|mobile|mozilla)-1': 600
              default: 120
  - pool_id: '{pool-group}/images-gcp'
    description: 'Builds docker images; NOTE: capacity set to 1 instead of 3
      to try to avoid [issues with dind](https://bugzilla.mozilla.org/show_bug.cgi?id=1427096)'
    owner: release+tc-workers@mozilla.com
    email_on_error: false
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    variants:
      - pool-group: gecko-1
      - pool-group: gecko-2
      - pool-group: gecko-3
        chain-of-trust: trusted
      - pool-group: comm-1
      - pool-group: comm-2
      - pool-group: comm-3
        chain-of-trust: trusted
      - pool-group: adhoc-1
      - pool-group: adhoc-3
        chain-of-trust: trusted
      - pool-group: app-services-1
      - pool-group: app-services-3
        chain-of-trust: trusted
      - pool-group: mozilla-1
      - pool-group: mozilla-3
        chain-of-trust: trusted
      - pool-group: mozillavpn-1
      - pool-group: mozillavpn-3
        chain-of-trust: trusted
      - pool-group: mobile-1
      - pool-group: mobile-3
        chain-of-trust: trusted
      - pool-group: nss-1
      - pool-group: nss-3
        chain-of-trust: trusted
      - pool-group: glean-1
      - pool-group: glean-3
        chain-of-trust: trusted
      - pool-group: xpi-1
      - pool-group: xpi-3
        chain-of-trust: trusted
      - pool-group: taskgraph-1
      - pool-group: taskgraph-3
        chain-of-trust: trusted
      - pool-group: ci-1
      - pool-group: ci-3
        chain-of-trust: trusted
      - pool-group: scriptworker-1
      - pool-group: scriptworker-3
        chain-of-trust: trusted
      - pool-group: translations-1
    config:
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      security:
        by-chain-of-trust:
          trusted: trusted
          default:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          (comm|gecko)-.*: 30
          default: 10
      worker-config: {dindImage: taskcluster/dind-service:v4.1}
      regions: [us-central1, us-west1]
      instance_types:
        by-pool-group:
          (taskgraph|ci)-.*:
            - minCpuPlatform: Intel Cascadelake
              disks:
                - <<: *persistent-disk
                  diskSizeGb: 75
                - *scratch-disk
              machine_type: n2-standard-2
              capacityPerInstance: 1
          default:
            - minCpuPlatform: Intel Cascadelake
              disks:
                - <<: *persistent-disk
                  diskSizeGb: 75
                - *scratch-disk
              machine_type: c2-standard-4
              capacityPerInstance: 1
  - pool_id: '{pool-group}/images-gcp-aarch64'
    description: Builds AArch64 docker images
    owner: release+tc-workers@mozilla.com
    variants:
      - pool-group: gecko-1
      - pool-group: gecko-2
      - pool-group: gecko-3
        chain-of-trust: trusted
    email_on_error: false
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          gecko-.*: 10
      implementation: generic-worker/worker-runner-linux-multi
      # the "t2a" machine series is only available in the "a", "b", and "f" zones of the "us-central1" region.
      regions: [us-central1]
      image: monopacker-ubuntu-2204-wayland-arm64
      security:
        by-chain-of-trust:
          trusted: trusted
          default:
      instance_types:
        - minCpuPlatform: Ampere Altra
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
          machine_type: t2a-standard-4
  - pool_id: '{pool-group}/t-linux-xlarge{suffix}-gcp'
    description: Worker for gecko-based automation.
    owner: release+tc-workers@mozilla.com
    variants:
      - pool-group: gecko-t
        suffix: ''
      - pool-group: gecko-3
        suffix: ''
        chain-of-trust: trusted
      - pool-group: comm-t
        suffix: ''
      - pool-group: gecko-t
        suffix: -source
      - pool-group: comm-t
        suffix: -source
      - pool-group: nss-t
        suffix: ''
    email_on_error: true
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          gecko-.*:
            by-suffix:
              '': 2500
              -source: 200
          nss-t: 100
          comm-t: 10
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-gcp-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
            - *scratch-disk
          machine_type: n2-standard-4
  - pool_id: '{pool-group}/t-linux-xlarge{suffix}-gcp-b1862675'
    description: Worker for gecko-based automation.
    owner: release+tc-workers@mozilla.com
    variants:
      - pool-group: gecko-t
        suffix: ''
      - pool-group: gecko-t
        suffix: -source
    email_on_error: true
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          gecko-.*:
            by-suffix:
              '': 2500
              -source: 200
          nss-t: 100
          comm-t: 10
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-gcp-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
            - *scratch-disk
          machine_type: c2-standard-8
  - pool_id: '{pool-group}/t-linux-xlarge{suffix}-noscratch-gcp'
    description: Worker for gecko-based automation.
    owner: release+tc-workers@mozilla.com
    variants:
      - pool-group: gecko-t
        suffix: ''
      - pool-group: gecko-3
        suffix: ''
        chain-of-trust: trusted
      - pool-group: comm-t
        suffix: ''
      - pool-group: gecko-t
        suffix: -source
      - pool-group: comm-t
        suffix: -source
      - pool-group: nss-t
        suffix: ''
    email_on_error: true
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          gecko-.*:
            by-suffix:
              '': 2500
              -source: 200
          nss-t: 100
          comm-t: 10
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: handbuilt-docker-worker-tester-20240614
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
          machine_type: n2-standard-4
  - pool_id: '{pool-group}/t-linux-xlarge{suffix}-ns-gcp-b1862675'
    description: Worker for gecko-based automation.
    owner: release+tc-workers@mozilla.com
    variants:
      - pool-group: gecko-t
        suffix: ''
      - pool-group: gecko-t
        suffix: -source
    email_on_error: true
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          gecko-.*:
            by-suffix:
              '': 2500
              -source: 200
          nss-t: 100
          comm-t: 10
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: handbuilt-docker-worker-tester-20240614
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
          machine_type: c2-standard-8
  - pool_id: 'gecko-t/t-linux-kvm-gcp'
    description: Worker for gecko-based automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 400
      regions: [us-central1, us-west1]
      image: monopacker-docker-worker-gcp-current
      worker-config:
        deviceManagement:
          kvm:
            enabled: true
        dockerConfig:
          allowPrivileged: true
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
            - *scratch-disk
          machine_type: n2-standard-8
          advancedMachineFeatures:
            enableNestedVirtualization: true
  - pool_id: 'gecko-t/t-linux-kvm-noscratch-gcp'
    description: Worker for gecko-based automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 800
      regions: [us-central1, us-west1]
      image: handbuilt-docker-worker-tester-20240614
      worker-config:
        deviceManagement:
          kvm:
            enabled: true
        dockerConfig:
          allowPrivileged: true
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
          machine_type: n2-standard-8
          advancedMachineFeatures:
            enableNestedVirtualization: true
  - pool_id: 'gecko-t/t-linux-kvm-gcp-bug1862675'
    description: Worker for gecko-based automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 400
      regions: [us-central1, us-west1]
      image: monopacker-docker-worker-gcp-current
      worker-config:
        deviceManagement:
          kvm:
            enabled: true
        dockerConfig:
          allowPrivileged: true
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
            - *scratch-disk
          machine_type: c2-standard-8
          advancedMachineFeatures:
            enableNestedVirtualization: true
  - pool_id: 'gecko-t/t-linux-kvm-noscratch-gcp-bug1862675'
    description: Worker for gecko-based automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 400
      regions: [us-central1, us-west1]
      image: handbuilt-docker-worker-tester-20240614
      worker-config:
        deviceManagement:
          kvm:
            enabled: true
        dockerConfig:
          allowPrivileged: true
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
          machine_type: c2-standard-8
          advancedMachineFeatures:
            enableNestedVirtualization: true
  - pool_id: '{pool-group}/b-linux-kvm-gcp'
    description: 'KVM-enabled builders for PGO using docker-worker.'
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: gecko-1
      - pool-group: gecko-2
      - pool-group: gecko-3
        chain-of-trust: trusted
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 10
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current  # or monopacker-docker-worker-gcp-current? not sure the diff.
      worker-config:
        deviceManagement:
          kvm:
            enabled: true
        dockerConfig:
          allowPrivileged: false  # not allowed on l3
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
            - *scratch-disk
            - *scratch-disk
          machine_type: c2-standard-16
          advancedMachineFeatures:
            enableNestedVirtualization: true
  - pool_id: '{pool-group}/b-linux-2204-kvm-gcp'  # Bug 1865886, https://mozilla-hub.atlassian.net/browse/RELOPS-805
    description: 'KVM-enabled Ubuntu 22.04 GCP builders.'
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: gecko-1
      - pool-group: gecko-3
        chain-of-trust: trusted
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: monopacker-ubuntu-2204-wayland  # use temporarily until monopacker-ubuntu-2204 is working.
      minCapacity: 0
      maxCapacity: 10
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
          machine_type: c2-standard-4
          advancedMachineFeatures:
            enableNestedVirtualization: true
  - pool_id: 'gecko-t/t-linux-vm-2204-wayland{suffix}'  # Bug 1756660 - These pools are experimental
    description: Worker for testing Wayland and XWayland on Ubuntu 22.04
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - suffix: ''
      - suffix: '-snap'
    provider_id: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            livelogExecutable: /home/ubuntu/.taskcluster/livelog
            taskclusterProxyExecutable: /home/ubuntu/.taskcluster/taskcluster-proxy
            numberOfTasksToRun: 1  # gw simple uses 1 to exit after one task
            idleTimeoutSecs: 5400
      minCapacity: 0
      maxCapacity: 500
      implementation: generic-worker/worker-runner-linux
      regions: [us-central1, us-west1]
      image: handbuilt-ubuntu-2204-wayland-vm
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 60
          machine_type: n2-standard-2
          advancedMachineFeatures:
            enableNestedVirtualization: true
  - pool_id: '{pool-group}/t-linux-2204-wayland{suffix}'  # Bug 1874877
    variants:
      - pool-group: gecko-t
        suffix: ''
      - pool-group: gecko-t
        suffix: '-snap'
      - pool-group: mozilla-t
        suffix: ''
    description: Worker for Wayland on Ubuntu 22.04
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            enableInteractive: true  # ok for l1, but not ok for l3?
      minCapacity: 0
      maxCapacity: 100
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: monopacker-ubuntu-2204-wayland
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 60
          machine_type: c2-standard-4
  - pool_id: '{pool-group}/t-linux-2204-wayland-relsre'
    description: Workers for Wayland on Ubuntu 22.04. Used by RelSRE to qualify images.
    owner: aerickson@mozilla.com
    email_on_error: true
    variants:
      - pool-group: gecko-t
      - pool-group: gecko-3
        chain-of-trust: trusted
    provider_id:
      by-chain-of-trust:
        default: fxci-level1-gcp
        trusted: fxci-level3-gcp
    config:
      minCapacity: 0
      maxCapacity: 10
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: monopacker-gw-gcp-wayland-gui-relops1071
      security:
        by-chain-of-trust:
          trusted: trusted
          default:
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 60
          machine_type: c2-standard-4
  - pool_id: '{pool-group}/t-linux-2204-wayland-arm64-relsre'
    description: Workers for Wayland on Ubuntu 22.04 ARM64. Used by RelSRE to qualify images.
    owner: aerickson@mozilla.com
    variants:
      - pool-group: gecko-t
      - pool-group: gecko-3
        chain-of-trust: trusted
    email_on_error: true
    provider_id:
      by-chain-of-trust:
        default: fxci-level1-gcp
        trusted: fxci-level3-gcp
    config:
      minCapacity: 0
      maxCapacity: 10
      implementation: generic-worker/worker-runner-linux-multi
      # the "t2a" machine series is only available in the "a", "b", and "f" zones of the "us-central1" region.
      regions: [us-central1]
      image: monopacker-gw-gcp-wayland-gui-arm64-relops1071
      security:
        by-chain-of-trust:
          trusted: trusted
          default:
      instance_types:
        - minCpuPlatform: Ampere Altra
          disks:
            - <<: *persistent-disk
              diskSizeGb: 60
          machine_type: t2a-standard-4
  - pool_id: '{pool-group}/t-linux-2404-wayland-relsre'
    description: Workers for Wayland on Ubuntu 24.04. Used by RelSRE to qualify images.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    variants:
      - pool-group: gecko-t
    config:
      worker-config:
        genericWorker:
          config:
            ed25519SigningKeyLocation: '/etc/generic-worker/ed25519_key'
            enableD2G: true
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 10
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: relsre-gw-fxci-gcp-2404-amd64-gui-alpha
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 60
          machine_type: c2-standard-4
  - pool_id: '{pool-group}/t-linux-2404-relsre'
    description: Workers running Ubuntu 24.04. Used by RelSRE to qualify images.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    variants:
      - pool-group: gecko-t
    config:
      worker-config:
        genericWorker:
          config:
            ed25519SigningKeyLocation: '/etc/generic-worker/ed25519_key'
            enableD2G: true
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 10
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: relsre-gw-fxci-gcp-2404-amd64-alpha
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 60
          machine_type: c2-standard-4
  - pool_id: '{pool-group}/t-linux-2404-headless-alpha'
    description: Workers running Ubuntu 24.04. Used by RelSRE to qualify images.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    variants:
      - pool-group: gecko-t
    config:
      worker-config:
        genericWorker:
          config:
            ed25519SigningKeyLocation: '/etc/generic-worker/ed25519_key'
            enableD2G: true
            enableInteractive: true
            headlessTasks: true
      minCapacity: 0
      maxCapacity: 10
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: ubuntu-2404-headless-alpha
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 60
          machine_type: c2-standard-4
  - pool_id: '{pool-group}/t-linux-2404-wayland{suffix}'  # Bug 1902716
    variants:
      - pool-group: gecko-t
        suffix: ''
      - pool-group: gecko-t
        suffix: '-snap'
      - pool-group: mozilla-t
        suffix: ''
    description: Worker for Wayland on Ubuntu 24.04
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            ed25519SigningKeyLocation: '/etc/generic-worker/ed25519_key'
            enableD2G: true
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 100
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: ubuntu-2404-wayland
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 60
          machine_type: c2-standard-4
  - pool_id: '{pool-group}/t-linux-xlarge-2404-wayland'  # Bug 1902716
    variants:
      - pool-group: gecko-t
    description: Worker for Wayland on Ubuntu 24.04
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            ed25519SigningKeyLocation: '/etc/generic-worker/ed25519_key'
            enableD2G: true
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 100
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: ubuntu-2404-wayland
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 60
          machine_type: c2-standard-8
  - pool_id: 'gecko-t/t-linux-2204-wayland-root-exp'  # Bug 1874877
    description: Worker for testing Wayland on Ubuntu 22.04
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            enableInteractive: true  # ok for l1, but not ok for l3?
      minCapacity: 0
      maxCapacity: 10
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: monopacker-ubuntu-2204-wayland
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 60
          machine_type: n2-standard-2
  - pool_id: '{pool-group}/t-linux-xlarge-2204-wayland'  # Bug 1903073
    variants:
      - pool-group: gecko-t
    description: Worker for Wayland on Ubuntu 22.04
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            enableInteractive: true  # ok for l1, but not ok for l3?
      minCapacity: 0
      maxCapacity: 100
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: monopacker-ubuntu-2204-wayland
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 60
          machine_type: c2-standard-8
  - pool_id: '{pool-group}/b-linux-v100-gpu'
    description: Worker for machine learning and other high GPU tasks
    owner: release+tc-workers@mozilla.com
    variants:
      - pool-group: translations-1
    email_on_error: true
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 200
      implementation: generic-worker/worker-runner-linux
      regions: [us-central1, us-west1, us-east1]
      image: monopacker-translations-worker
      instance_types:
        - minCpuPlatform: Intel Skylake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
          machine_type: n1-highmem-8
          guestAccelerators:
            - acceleratorCount: 1
              acceleratorType: nvidia-tesla-v100
  - pool_id: '{pool-group}/b-linux-v100-gpu-4'
    description: Worker for machine learning and other high GPU tasks
    owner: release+tc-workers@mozilla.com
    variants:
      - pool-group: translations-1
    email_on_error: true
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      # We use 4 GPUs per instance across 4 regions with a limit of 128
      # per region at any given time. 4 regions * 4 GPUs = 512 total GPUs
      # 512 GPUs / 4 per instance = 128 instances possibly running at once.
      maxCapacity: 128
      implementation: generic-worker/worker-runner-linux
      regions: [us-central1, us-west1, us-east1, europe-west4]
      image: monopacker-translations-worker
      instance_types:
        - minCpuPlatform: Intel Skylake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
          machine_type: n1-highmem-8
          guestAccelerators:
            - acceleratorCount: 4
              acceleratorType: nvidia-tesla-v100
  - pool_id: '{pool-group}/b-linux-v100-gpu-4-300gb'
    description: Worker for machine learning and other high GPU tasks
    owner: release+tc-workers@mozilla.com
    variants:
      - pool-group: translations-1
    email_on_error: true
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      # We use 4 GPUs per instance across 4 regions with a limit of 128
      # per region at any given time. 4 regions * 4 GPUs = 512 total GPUs
      # 512 GPUs / 4 per instance = 128 instances possibly running at once.
      maxCapacity: 128
      implementation: generic-worker/worker-runner-linux
      regions: [us-central1, us-west1, us-east1, europe-west4]
      image: monopacker-translations-worker
      instance_types:
        - minCpuPlatform: Intel Skylake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 300
          # 40 CPUs, 256GB RAM
          machine_type: n1-custom-40-262144
          guestAccelerators:
            - acceleratorCount: 4
              acceleratorType: nvidia-tesla-v100
  - pool_id: '{pool-group}/b-linux-v100-gpu-4-300gb-standard'
    description: Worker for machine learning tasks that require standard VMs
    owner: release+tc-workers@mozilla.com
    variants:
      - pool-group: translations-1
    email_on_error: true
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 50
      implementation: generic-worker/worker-runner-linux
      regions: [us-central1, us-west1]
      image: monopacker-translations-worker
      instance_types:
        - minCpuPlatform: Intel Skylake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 300
          # 40 CPUs, 256GB RAM
          machine_type: n1-custom-40-262144
          scheduling: standard
          guestAccelerators:
            - acceleratorCount: 4
              acceleratorType: nvidia-tesla-v100
  - pool_id: '{pool-group}/b-linux-v100-gpu-4-1tb-standard'
    description: Worker for machine learning tasks that require standard VMs
    owner: release+tc-workers@mozilla.com
    variants:
      - pool-group: translations-1
    email_on_error: true
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      maxCapacity: 50
      implementation: generic-worker/worker-runner-linux
      regions: [us-central1, us-west1]
      image: monopacker-translations-worker
      instance_types:
        - minCpuPlatform: Intel Skylake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 1024
          # 40 CPUs, 256GB RAM
          machine_type: n1-custom-40-262144
          scheduling: standard
          guestAccelerators:
            - acceleratorCount: 4
              acceleratorType: nvidia-tesla-v100
  - pool_id: '{pool-group}/b-linux-v100-gpu-4-1tb'
    description: Worker for machine learning and other high GPU tasks
    owner: release+tc-workers@mozilla.com
    variants:
      - pool-group: translations-1
    email_on_error: true
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      # We use 4 GPUs per instance across 4 regions with a limit of 128
      # per region at any given time. 4 regions * 4 GPUs = 512 total GPUs
      # 512 GPUs / 4 per instance = 128 instances possibly running at once.
      maxCapacity: 128
      implementation: generic-worker/worker-runner-linux
      regions: [us-central1, us-west1, us-east1, europe-west4]
      image: monopacker-translations-worker
      instance_types:
        - minCpuPlatform: Intel Skylake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 1024
          # 40 CPUs, 256GB RAM
          machine_type: n1-custom-40-262144
          guestAccelerators:
            - acceleratorCount: 4
              acceleratorType: nvidia-tesla-v100
  - pool_id: '{pool-group}/b-linux-v100-gpu-4-2tb'
    description: Worker for machine learning and other high GPU tasks
    owner: release+tc-workers@mozilla.com
    variants:
      - pool-group: translations-1
    email_on_error: true
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      worker-config:
        genericWorker:
          config:
            # 2592000s is 30 days.
            maxTaskRunTime: 2592000
            enableInteractive: true
      minCapacity: 0
      # We use 4 GPUs per instance across 4 regions with a limit of 128
      # per region at any given time. 4 regions * 4 GPUs = 512 total GPUs
      # 512 GPUs / 4 per instance = 128 instances possibly running at once.
      maxCapacity: 128
      implementation: generic-worker/worker-runner-linux
      regions: [us-central1, us-west1, us-east1, europe-west4]
      image: monopacker-translations-worker
      instance_types:
        - minCpuPlatform: Intel Skylake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 2048
          # 40 CPUs, 256GB RAM
          machine_type: n1-custom-40-262144
          guestAccelerators:
            - acceleratorCount: 4
              acceleratorType: nvidia-tesla-v100
  - pool_id: '{pool-group}/misc-gcp'
    description: Miscellaneous short, low-latency, simple tasks, shared between Gecko
      SCM levels.  Used for things like indexing tasks.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: gecko-t
      - pool-group: comm-t
    provider_id: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 32
      regions: [us-central1, us-west1]
      image: monopacker-docker-worker-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 20
            - *scratch-disk
          machine_type: c2-standard-4
          capacityPerInstance: 8
  - pool_id: '{pool-group}/b-win2012-azure'
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    variants:
      - pool-group: gecko-1
      - pool-group: gecko-2
      - pool-group: gecko-3
        chain-of-trust: trusted
      - pool-group: comm-1
      - pool-group: comm-2
      - pool-group: comm-3
        chain-of-trust: trusted
    provider_id:
      by-chain-of-trust:
        trusted: azure_trusted
        default: azure2
    config:
      image:
        by-chain-of-trust:
          trusted: ronin-b3-windows2012-prod
          default: ronin-b1-windows2012-prod
      image_resource_group: rg-packer-through-cib
      implementation: generic-worker/worker-runner-windows
      locations: [central-us, north-central-us, east-us-2, west-us-2]
      maxCapacity:
        by-pool-group:
          gecko-.*: 500
          comm-3: 50
          comm-(1|2): 25
      worker-config:
        genericWorker:
          config:
            idleTimeoutSecs: 1800
      tags:
        sourceScript: provisioners/windows/azure/azure-bootstrap.ps1
        sourceBranch: cloud_windows
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize: Standard_F32s_v2
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                createOption: FromImage
              dataDisks:
                - lun: 0
                  diskSizeGB: 120
                  managedDisk:
                    storageAccountType: Premium_LRS
                  createOption: Empty
            hardwareProfile:
              vmSize: Standard_F32s_v2
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  - pool_id: '{pool-group}/b-win2012-azure{suffix}'
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    attributes:
      suffix: ''
      track: prod
    variants:
      - pool-group: nss-1
      - pool-group: nss-1
        track: alpha
        suffix: -alpha
      - pool-group: nss-3
        chain-of-trust: trusted
    provider_id:
      by-chain-of-trust:
        trusted: azure_trusted
        default: azure2
    config:
      image:
        by-chain-of-trust:
          trusted: ronin-b3-windows2012-vs-py2-{track}
          default: ronin-b1-windows2012-vs-py2-{track}
      image_resource_group: rg-packer-through-cib
      implementation: generic-worker/worker-runner-windows
      worker-purpose: '{pool-group}'
      locations:
        by-track:
          alpha: [central-us, north-central-us]
          default: [central-us, north-central-us, east-us-2, west-us-2]
      maxCapacity: 25
      worker-config:
        genericWorker:
          config:
            idleTimeoutSecs: 1800
      tags:
        sourceScript: provisioners/windows/azure/azure-bootstrap.ps1
        sourceBranch: cloud_windows
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize: Standard_F32s_v2
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                createOption: FromImage
              dataDisks:
                - lun: 0
                  diskSizeGB: 120
                  managedDisk:
                    storageAccountType: Premium_LRS
                  createOption: Empty
            hardwareProfile:
              vmSize: Standard_F32s_v2
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  # Windows Server 2022
  - pool_id: gecko-1/b-win2022-alpha
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    provider_id: azure2
    config:
      image: ronin-b-windows2022-alpha
      image_resource_group: rg-packer-through-cib
      implementation: generic-worker/worker-runner-windows
      worker-purpose: gecko-1
      locations: [central-us, north-central-us]
      maxCapacity: 5
      worker-config:
        genericWorker:
          config:
            workerType: win2022-azure
            cachesDir: D:\caches
            downloadsDir: D:\downloads
            tasksDir: D:\
      tags:
        sourceScript: provisioners/windows/azure/azure-bootstrap.ps1
        sourceBranch: bug1838725
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize: Standard_F32s_v2
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                caching: ReadOnly
                createOption: FromImage
                diffDiskSettings:
                  option: Local
            hardwareProfile:
              vmSize: Standard_F32s_v2
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  - pool_id: '{pool-group}/b-win2022'
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    variants:
      - pool-group: gecko-1
      - pool-group: gecko-2
      - pool-group: gecko-3
        chain-of-trust: trusted
      - pool-group: comm-1
      - pool-group: comm-2
      - pool-group: comm-3
        chain-of-trust: trusted
      - pool-group: mozilla-1
      - pool-group: mozilla-3
        chain-of-trust: trusted
      - pool-group: mozillavpn-1
      - pool-group: mozillavpn-3
        chain-of-trust: trusted
      - pool-group: relops-1
      - pool-group: relops-3
        chain-of-trust: trusted
    provider_id:
      by-chain-of-trust:
        trusted: azure_trusted
        default: azure2
    config:
      image:
        by-chain-of-trust:
          trusted: ronin-b3-windows2022-prod
          default: ronin-b1-windows2022-prod
      image_resource_group: rg-packer-through-cib
      implementation: generic-worker/worker-runner-windows
      locations:
        by-pool-group:
          .*-3: [central-us, east-us-2, west-us-2]
          default: [central-us, north-central-us, east-us-2, west-us-2]
      maxCapacity:
        by-pool-group:
          gecko-.*: 500
          comm-3: 50
          comm-(1|2): 25
          mozillavpn-.*: 25
          mozilla-.*: 25
          relops-.*: 12
      worker-purpose:
        by-pool-group:
          mozillavpn-1: vpn-1
          mozillavpn-3: vpn-3
          default: null  # defaults to pool-group
      worker-config:
        genericWorker:
          config:
            cachesDir: D:\caches
            downloadsDir: D:\downloads
            tasksDir: D:\
      tags:
        sourceScript: provisioners/windows/azure/2022-azure-bootstrap.ps1
        sourceBranch: windows
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize: Standard_F32s_v2
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                caching: ReadOnly
                createOption: FromImage
                diffDiskSettings:
                  option: Local
            hardwareProfile:
              vmSize: Standard_F32s_v2
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  - pool_id: nss-1/b-win2022-alpha
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    provider_id: azure2
    config:
      image: ronin-b-windows2022-alpha
      image_resource_group: rg-packer-through-cib
      implementation: generic-worker/worker-runner-windows
      worker-purpose: nss-1
      locations: [central-us, north-central-us]
      maxCapacity: 25
      worker-config:
        genericWorker:
          config:
            cachesDir: D:\caches
            downloadsDir: D:\downloads
            tasksDir: D:\
      tags:
        sourceScript: provisioners/windows/azure/2022-azure-bootstrap.ps1
        sourceBranch: windows
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize: Standard_F32s_v2
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                caching: ReadOnly
                createOption: FromImage
                diffDiskSettings:
                  option: Local
            hardwareProfile:
              vmSize: Standard_F32s_v2
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  - pool_id: mozillavpn-1/b-win2022-alpha
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    provider_id: azure2
    config:
      image: ronin-b-windows2022-alpha
      image_resource_group: rg-packer-through-cib
      implementation: generic-worker/worker-runner-windows
      worker-purpose: vpn-1
      locations: [central-us, north-central-us]
      maxCapacity: 25
      worker-config:
        genericWorker:
          config:
            cachesDir: D:\caches
            downloadsDir: D:\downloads
            tasksDir: D:\
      tags:
        sourceScript: provisioners/windows/azure/2022-azure-bootstrap.ps1
        sourceBranch: windows
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize: Standard_F32s_v2
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                caching: ReadOnly
                createOption: FromImage
                diffDiskSettings:
                  option: Local
            hardwareProfile:
              vmSize: Standard_F32s_v2
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  # Windows 10
  - pool_id: '{pool-group}/win10-64-2009-{suffix}'
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    provider_id: azure2
    attributes:
      suffix: ''
    variants:
      - pool-group: gecko-t
      - pool-group: gecko-t
        suffix: gpu
      - pool-group: gecko-t
        suffix: source
      - pool-group: gecko-t
        suffix: alpha
      - pool-group: gecko-t
        suffix: source-alpha
      - pool-group: gecko-t
        suffix: gpu-alpha
    config:
      image:
        by-suffix:
          .*alpha: ronin-t-windows10-64-2009-alpha
          default: ronin-t-windows10-64-2009-prod
      image_resource_group: rg-packer-through-cib
      implementation: generic-worker/worker-runner-windows
      worker-purpose: gecko-t
      locations:
        by-suffix:
          alpha: [uk-west]
          source-alpha: [east-us, east-us-2, west-us, west-us-2, north-central-us, central-us]
          gpu-alpha: [uk-south]
          gpu: [east-us, east-us-2, west-us, west-us-2]
          default: [canada-central, central-india, east-us, east-us-2, west-us, west-us-2, west-us-3, north-central-us, central-us, north-europe, south-india]
      maxCapacity:
        by-suffix:
          '': 600
          alpha: 500
          default: 100
      worker-config:
        genericWorker:
          config:
            workerType: 'win10-64-2009-{suffix}'
            provisionerId: gecko-t
            cachesDir: D:\caches
            downloadsDir: D:\downloads
            tasksDir: D:\
      tags:
        sourceScript: provisioners/windows/azure/azure-bootstrap.ps1
        sourceBranch: windows
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize:
            by-suffix:
              gpu(-alpha)?: Standard_NV12s_v3
              default: Standard_F8s_v2
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                caching: ReadOnly
                createOption: FromImage
                diffDiskSettings:
                  option: Local
            hardwareProfile:
              vmSize:
                by-suffix:
                  gpu(-alpha)?: Standard_NV12s_v3
                  default: Standard_F8s_v2
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  # Windows 11
  - pool_id: '{pool-group}/win11-a64-24h2-builder-{suffix}'
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    attributes:
      suffix: ''
      level: 1
    variants:
      - pool-group: gecko-1
      - pool-group: gecko-3
        level: 3
      - pool-group: gecko-1
        suffix: alpha
    provider_id:
      by-level:
        1: azure2
        3: azure_trusted
    config:
      image: 'ronin_b{level}_windows11_a64_24h2_builder_{suffix}'
      implementation: generic-worker/worker-runner-windows
      worker-purpose: '{pool-group}'
      locations: [east-us-2, west-us-3, north-central-us, central-us]
      maxCapacity: 250
      worker-config:
        genericWorker:
          config:
            workerType: win11-a64-24h2-builder-alpha
            provisionerId: gecko-1
            cachesDir: C:\caches
            downloadsDir: C:\downloads
            tasksDir: C:\
      tags:
        sourceScript: provisioners/windows/azure/azure-bootstrap.ps1
        sourceBranch: win11Aarch64
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize:
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                managedDisk:
                  storageAccountType: Premium_LRS
                createOption: FromImage
            hardwareProfile:
              vmSize: Standard_D16ps_v5
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  - pool_id: '{pool-group}/win11-64-2009-{suffix}'
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    provider_id: azure2
    attributes:
      suffix: ''
    variants:
      - pool-group: gecko-t
      - pool-group: gecko-t
        suffix: alpha
      - pool-group: gecko-t
        suffix: gpu 
      - pool-group: gecko-t
        suffix: gpu-alpha 
      - pool-group: gecko-t
        suffix: source
      - pool-group: gecko-t
        suffix: source-alpha
      - pool-group: gecko-t
        suffix: ssd
      - pool-group: gecko-t
        suffix: ssd-gpu
      - pool-group: comm-t
      - pool-group: comm-t
        suffix: ssd
    config:
      image:
        by-suffix:
          .*alpha: ronin-t-windows11-64-2009-alpha
          default: ronin-t-windows11-64-2009-prod
      image_resource_group: rg-packer-through-cib
      implementation: generic-worker/worker-runner-windows
      worker-purpose: '{pool-group}'
      locations:
        by-pool-group:
          comm-t:
            by-suffix:
              ssd: [east-us, east-us-2, west-us, west-us-2, north-central-us, central-us]
              default: [canada-central, east-us, east-us-2, west-us, west-us-2, west-us-3, north-central-us, central-us, north-europe, south-india]
          default:
            by-suffix:
              (source-)?alpha: [uk-south]
              gpu: [east-us, east-us-2, west-us, west-us-2]
              gpu-alpha: [west-us, west-us-2]
              (ssd|source): [east-us, east-us-2, west-us, west-us-2, north-central-us, central-us]
              ssd-gpu: [north-europe, east-us, east-us-2]
              default: [canada-central, central-india, east-us, east-us-2, west-us, west-us-2, west-us-3, north-central-us, central-us, north-europe, south-india]
      maxCapacity:
        by-pool-group:
          comm-t:
            by-suffix:
              '': 600
              default: 50
          gecko-t:
            by-suffix:
              '': 1200
              alpha: 500
              gpu: 600
              default: 100
      worker-config:
        genericWorker:
          config:
            workerType: 'win11-64-2009-{suffix}'
            provisionerId: '{pool-group}'
            cachesDir: D:\caches
            downloadsDir: D:\downloads
            tasksDir: D:\
      tags:
        sourceScript: provisioners/windows/azure/azure-bootstrap.ps1
        sourceBranch: cloud_windows
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize:
            by-suffix:
              .*gpu.*: Standard_NV12s_v3
              default: Standard_F8s_v2
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                caching: ReadOnly
                createOption: FromImage
                diffDiskSettings:
                  option: Local
            hardwareProfile:
              vmSize:
                by-suffix:
                  .*gpu.*: Standard_NV12s_v3
                  default: Standard_F8s_v2
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  - pool_id: '{pool-group}/win11-64-24h2-{suffix}'
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    provider_id: azure2
    attributes:
      suffix: ''
    variants:
      - pool-group: gecko-t
      - pool-group: gecko-t
        suffix: alpha
    config:
      image: 'ronin_t_windows11_64_24h2_{suffix}'
      image_resource_group: rg-packer-through-cib
      implementation: generic-worker/worker-runner-windows
      worker-purpose: '{pool-group}'
      locations:
        by-suffix:
          alpha: [uk-south]
          default: [canada-central, central-india, east-us, east-us-2, west-us, west-us-2, west-us-3, north-central-us, central-us, north-europe, south-india]
      maxCapacity: 500
      worker-config:
        genericWorker:
          config:
            workerType: 'win11-64-24h2-{suffix}'
            provisionerId: gecko-t
            cachesDir: D:\caches
            downloadsDir: D:\downloads
            tasksDir: D:\
      tags:
        sourceScript: provisioners/windows/azure/azure-bootstrap.ps1
        sourceBranch: windows
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize: Standard_F8s_v2
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                caching: ReadOnly
                createOption: FromImage
                diffDiskSettings:
                  option: Local
            hardwareProfile:
              vmSize: Standard_F8s_v2
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  - pool_id: gecko-t/win11-a64-24h2-alpha
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    provider_id: azure2
    config:
      image: ronin_t_windows11_a64_24h2_tester_alpha
      implementation: generic-worker/worker-runner-windows
      worker-purpose: gecko-t
      locations: [east-us-2, north-central-us, central-us]
      maxCapacity: 500
      worker-config:
        genericWorker:
          config:
            workerType: win11-a64-24h2-alpha
            provisionerId: gecko-t
            cachesDir: C:\caches
            downloadsDir: C:\downloads
            tasksDir: C:\
      tags:
        sourceScript: provisioners/windows/azure/azure-bootstrap.ps1
        sourceBranch: windows
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize:
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                createOption: FromImage
            hardwareProfile:
              vmSize: Standard_D8ps_v5
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  - pool_id: gecko-t/win11-a64-24h2
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    provider_id: azure2
    config:
      image: ronin_t_windows11_a64_24h2_tester
      implementation: generic-worker/worker-runner-windows
      worker-purpose: gecko-t
      locations: [east-us-2, north-central-us, central-us]
      maxCapacity: 500
      worker-config:
        genericWorker:
          config:
            workerType: win11-a64-24h2
            provisionerId: gecko-t
            cachesDir: C:\caches
            downloadsDir: C:\downloads
            tasksDir: C:\
      tags:
        sourceScript: provisioners/windows/azure/azure-bootstrap.ps1
        sourceBranch: cloud_windows
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize:
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                createOption: FromImage
            hardwareProfile:
              vmSize: Standard_D8ps_v5
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  - pool_id: comm-t/win11-a64-24h2-alpha
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    provider_id: azure2
    config:
      image: ronin_t_windows11_a64_24h2_tester_alpha
      implementation: generic-worker/worker-runner-windows
      worker-purpose: comm-t
      locations: [east-us-2, north-central-us, central-us]
      maxCapacity: 500
      worker-config:
        genericWorker:
          config:
            workerType: win11-a64-24h2-alpha
            provisionerId: comm-t
            cachesDir: C:\caches
            downloadsDir: C:\downloads
            tasksDir: C:\
      tags:
        sourceScript: provisioners/windows/azure/azure-bootstrap.ps1
        sourceBranch: windows
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize:
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                createOption: FromImage
            hardwareProfile:
              vmSize: Standard_D8ps_v5
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  - pool_id: comm-t/win11-a64-24h2
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    provider_id: azure2
    config:
      image: ronin_t_windows11_a64_24h2_tester
      implementation: generic-worker/worker-runner-windows
      worker-purpose: comm-t
      locations: [east-us-2, north-central-us, central-us]
      maxCapacity: 500
      worker-config:
        genericWorker:
          config:
            workerType: win11-a64-24h2
            provisionerId: comm-t
            cachesDir: C:\caches
            downloadsDir: C:\downloads
            tasksDir: C:\
      tags:
        sourceScript: provisioners/windows/azure/azure-bootstrap.ps1
        sourceBranch: windows
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize:
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                createOption: FromImage
            hardwareProfile:
              vmSize: Standard_D8ps_v5
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  - pool_id: gecko-t/win11-64-2009-alpha-test
    description: ''
    owner: relops-azure-provisioning@mozilla.com
    email_on_error: true
    provider_id: azure2
    config:
      image: ronin-t-windows11-64-2009-alpha-test
      image_resource_group: rg-packer-through-cib
      implementation: generic-worker/worker-runner-windows
      worker-purpose: gecko-t
      locations: [east-us, east-us-2, west-us, west-us-2]
      maxCapacity: 100
      worker-config:
        genericWorker:
          config:
            workerType: win11-64-2009-alpha
            provisionerId: gecko-t
            idleTimeoutSecs: 5400
      tags:
        sourceScript: provisioners/windows/azure/azure-bootstrap.ps1
        sourceBranch: windows
        sourceRepository: ronin_puppet
        sourceOrganisation: mozilla-platform-ops
      spot: true
      vmSizes:
        - vmSize: Standard_F8s_v2
          launchConfig:
            osProfile:
              windowsConfiguration:
                timeZone: UTC
                enableAutomaticUpdates: false
            storageProfile:
              osDisk:
                osType: Windows
                createOption: FromImage
              dataDisks:
                - lun: 0
                  diskSizeGB: 30
                  managedDisk:
                    storageAccountType: StandardSSD_LRS
                  createOption: Empty
            hardwareProfile:
              vmSize: Standard_F8s_v2
            diagnosticsProfile:
              bootDiagnostics:
                enabled: false
      capacityPerInstance: 1
  - pool_id: '{pool-group}/t-linux-large-gcp'
    description: Worker for gecko-based automation.
    owner: release+tc-workers@mozilla.com
    provider_id: fxci-level1-gcp
    variants:
      - pool-group: gecko-t
      - pool-group: comm-t
      - pool-group: mozilla-t
    email_on_error: true
    config:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          gecko-t: 2500
          comm-t: 100
          mozilla-t: 100
      regions: [us-central1, us-west1]
      image: monopacker-docker-worker-gcp-current
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - autoDelete: true
              boot: true
              initializeParams:
                diskSizeGb: 75
                sourceImage: <image>
              type: PERSISTENT
            - autoDelete: true
              initializeParams:
                diskType: diskTypes/local-ssd
              type: SCRATCH
              interface: NVME
          machine_type: c2-standard-4
  - pool_id: '{pool-group}/t-linux-large-noscratch-gcp'
    description: Worker for gecko-based automation.
    owner: release+tc-workers@mozilla.com
    provider_id: fxci-level1-gcp
    variants:
      - pool-group: gecko-t
      - pool-group: comm-t
      - pool-group: mozilla-t
    email_on_error: true
    config:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          gecko-t: 2500
          comm-t: 100
          mozilla-t: 100
      regions: [us-central1, us-west1]
      image: handbuilt-docker-worker-tester-20240614
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - autoDelete: true
              boot: true
              initializeParams:
                diskSizeGb: 75
                sourceImage: <image>
              type: PERSISTENT
          machine_type: c2-standard-4
  - pool_id: 'gecko-t/t-linux-large-hostub2204-gcp'
    description: Worker for gecko-based automation.
    owner: release+tc-workers@mozilla.com
    provider_id: fxci-level1-gcp
    email_on_error: true
    config:
      minCapacity: 0
      maxCapacity: 200
      regions: [us-central1, us-west1]
      image: monopacker-docker-worker-relops528
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - autoDelete: true
              boot: true
              initializeParams:
                diskSizeGb: 75
                sourceImage: <image>
              type: PERSISTENT
            - autoDelete: true
              initializeParams:
                diskType: diskTypes/local-ssd
              type: SCRATCH
              interface: NVME
          machine_type: n2-standard-2
  - pool_id: code-review/bot-gcp
    description: Worker for the code-review bot.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    config:
      regions: [us-central1, us-west1]
      image: monopacker-docker-worker-current
      minCapacity: 1
      maxCapacity: 100
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 20
            - *scratch-disk
          machine_type: c2-standard-4
          capacityPerInstance: 2
      worker-config:
        shutdown:
          afterIdleSeconds: 900
  - pool_id: code-coverage/bot-gcp
    description: Worker for the code-coverage bot.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    provider_id: fxci-level1-gcp
    config:
      regions: [us-central1, us-west1]
      image: monopacker-docker-worker-current
      minCapacity: 1
      maxCapacity: 10
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
            - *scratch-disk
            - *scratch-disk
          machine_type: c2-standard-16
      worker-config:
        shutdown:
          afterIdleSeconds: 900
  - pool_id: '{pool-group}/linux-gcp'
    description: Worker for gecko-based automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: ci-t
      - pool-group: code-analysis-1
      - pool-group: code-analysis-3
        chain-of-trust: trusted
      - pool-group: nss-1
      - pool-group: nss-3
        chain-of-trust: trusted
      - pool-group: releng-t
      - pool-group: releng-1
      - pool-group: releng-3
        chain-of-trust: trusted
      - pool-group: taskgraph-t
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity:
        by-pool-group:
          nss-.*: 100
          default: 10
      regions: [us-central1, us-west1]
      image:
        by-chain-of-trust:
          trusted: monopacker-docker-worker-trusted-current-gcp
          default: monopacker-docker-worker-current
      security:
        by-chain-of-trust:
          trusted: trusted
          default:
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
            - *scratch-disk
          machine_type: c2-standard-4
  - pool_id: '{pool-group}/linux-gw-gcp'
    description: Worker for gecko-based automation.
    owner: release+tc-workers@mozilla.com
    email_on_error: true
    variants:
      - pool-group: code-analysis-1
      - pool-group: code-analysis-3
        chain-of-trust: trusted
    provider_id:
      by-chain-of-trust:
        trusted: fxci-level3-gcp
        default: fxci-level1-gcp
    config:
      minCapacity: 0
      maxCapacity: 10
      implementation: generic-worker/worker-runner-linux-multi
      regions: [us-central1, us-west1]
      image: monopacker-ubuntu-2204-wayland
      security:
        by-chain-of-trust:
          trusted: trusted
          default:
      instance_types:
        - minCpuPlatform: Intel Cascadelake
          disks:
            - <<: *persistent-disk
              diskSizeGb: 75
          machine_type: c2-standard-4
