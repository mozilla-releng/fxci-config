---
# Grants of scopes to repos or user groups, or parts of projects
#
# Format:
# - grant:
#   - <scope>
#   - ..
#   to:
#   - <grantee>
#   - ..
#
# The `grant` property specifies the scopes to be granted. Each will have {..}
# parameters expanded with parameters from the grantees selected.
#
# ## Projects
#
# A grantee can either be a project or a user group.  A project looks like this:
#
# - projects:
#     level: [2, 3]  # condition
#     job: ["branch:default", "cron:*"]
#
# The top-level property can be `projects` or `project`, whichever reads better.
#
# The conditions select matching projects from projects.yml.  Each specifies a
# condition name and either a single value or an array of values.  For an array
# of values, a project with any value in the array is matched.  The conditions
# are AND'ed together.  Available conditions are:
#
# * access
# * level (as derived from access or directly specified)
# * alias
# * feature (projects with the given feature or for `!feature`, projects without)
# * is_try (true/false)
# * trust_domain
# * job
#
# "job" is a little special: it is a list of the jobs on the matching projects
# to which the grant applies.  These are suffixes to the `repo` roles,
# defaulting to "*":
#
# * * (all jobs on the repo)
# * branch:default (pushes to the repo)
# * cron:<job> (cron jobs; kleene-* is allowed)
# * action:<actionPerm> (action jobs; kleene-* is allowed)
#
# The following expansions of the granted scopes are performed:
#
# * {alias} (project alias)
# * {level} (numeric level; not substituted if this repo has no numeric level)
# * {repo_path} (path within repository (e.g. hg.mozilla.org or github.com, if repo is on that host)
# * {trust_domain}
#
# ## User Groups
#
# A user group grantee looks like this:
#
# - group: <groupName>
# or
# - groups: [<group1>, <group2>, ..]
#
# The property name can be `group` or `groups`, whichever reads better.
#
# The resulting scopes are granted to role `project:releng:ci-group:<groupName>`.
# Then `assume:project:releng:ci-group:<groupName>` to the appropriate access-control
# role, hopefully with the same name. This indirection exists because `mozilla-group`
# role changes need access to the cluster's root crendentials.
#
# No expansions are available for user groups.

# Platform roles

- grant:
    # Scopes assigned to credentials generated by taskcluster-login; so, to human users.
    # The `*` matches the user's identity as defined by the taskcluster-login service.
    - auth:list-clients
    - auth:create-client:<..>/*
    - auth:delete-client:<..>/*
    - auth:reset-access-token:<..>/*
    - auth:update-client:<..>/*
    - queue:get-artifact:login-identity/<..>/*
    - queue:create-task:highest:built-in/succeed
    - queue:create-task:highest:built-in/fail
    - queue:pending-list:*
    - queue:claimed-list:*
  to:
    - roles:
        - login-identity:*

- grant:
    - queue:claim-work:<..>
    - queue:worker-id:*
    - secrets:get:worker-type:<..>
    - secrets:get:worker-pool:<..>
  to:
    - roles:
        - worker-type:*

- grant:
    - auth:websocktunnel-token:firefoxcitc/*
  to:
    - roles:
        - worker-type:*
  environments: firefoxci

- grant:
    - auth:websocktunnel-token:cloudopsstage/*
  to:
    - roles:
        - worker-type:*
  environments: staging

- grant:
    - auth:sentry:generic-worker
  to:
    - roles:
        - worker-type:releng-hardware/*
        - worker-type:performance-hardware/*

##
# scopes for all gecko-related projects

- grant:
    # coalescing routes support dropping unnecessary tasks under load
    - queue:route:coalesce.v1.{alias}.*

    # allow fetching secrets appropriate to this level
    # TODO: switch to trust-domain-scopes format
    - secrets:get:project/releng/{trust_domain}/build/level-{level}/*

    # Provide access to sccache buckets
    - assume:project:taskcluster:{trust_domain}:level-{level}-sccache-buckets
  to:
    - project:
        feature: gecko-roles

- grant:
    # access to workers; all levels have access to the same workers, but at
    # different priorities and levels
    - queue:create-task:{priority}:scriptworker-k8s/{trust_domain}-{level}-*
    - queue:create-task:{priority}:scriptworker-k8s/{trust_domain}-t-*
  to:
    - project:
        feature: gecko-roles
        trust_domain: [gecko, comm]

- grant:
    - queue:create-task:{priority}:scriptworker-k8s/{trust_domain}-1-*
  to:
    - project:
        alias: maple

- grant:
    - auth:gcp:access-token:sccache-3/comm-sccache-l1*
  to:
    - role:
        - project:taskcluster:comm:level-1-sccache-buckets

- grant:
    - auth:gcp:access-token:sccache-3/comm-sccache-l2*
  to:
    - role:
        - project:taskcluster:comm:level-2-sccache-buckets

- grant:
    - auth:gcp:access-token:sccache-3/comm-sccache-l3*
  to:
    - role:
        - project:taskcluster:comm:level-3-sccache-buckets

- grant:
    - auth:gcp:access-token:sccache-3/sccache-l1*
  to:
    - role:
        - project:taskcluster:gecko:level-1-sccache-buckets

- grant:
    - auth:gcp:access-token:sccache-3/sccache-l2*
  to:
    - role:
        - project:taskcluster:gecko:level-2-sccache-buckets

- grant:
    - auth:gcp:access-token:sccache-3/sccache-l3*
  to:
    - role:
        - project:taskcluster:gecko:level-3-sccache-buckets

- grant:
    # access to workers; all levels have access to the same workers, but at
    # different priorities and levels
    - queue:create-task:{priority}:bitbar/gecko-t-*
    - queue:create-task:{priority}:gecko-{level}/*
    - queue:create-task:{priority}:gecko-t/*
    - queue:create-task:{priority}:releng-hardware/gecko-{level}-*
    - queue:create-task:{priority}:releng-hardware/gecko-t-*
    - queue:create-task:{priority}:releng-hardware/win11-64-*
    - queue:create-task:{priority}:performance-hardware/gecko-t-*

    # access to openh264 artifacts; necessary for symbol upload and signing when
    # building new openh264 binaries
    - queue:get-artifact:private/openh264/*
  to:
    - project:
        feature: gecko-roles
        trust_domain: gecko

- grant:
    # Let's not require a separate level 2 pool for hardware
    - queue:create-task:{priority}:releng-hardware/gecko-1-*
  to:
    - project:
        feature: gecko-roles
        trust_domain: [gecko]
        level: 2

- grant:
    - queue:get-artifact:private/openh264/*
  to:
    - groups:
        - team_moco

- grant:
    # access to OSX testers
    - queue:create-task:{priority}:releng-hardware/gecko-t-osx-*
  to:
    - project:
        feature: gecko-roles
        trust_domain: comm

# moz-tree roles include the basic scopes available to version-control trees at
# each of the three Mozilla source-code management levels.  They are useful as
# shorthand to configure `repo:*` roles.  While most scopes are still contained
# in these grants, prefer to add new grants as separate stanzas in this file,
# and remove scopes from these grants.

- grant:
    - docker-worker:capability:device:loopbackAudio
    - docker-worker:capability:device:loopbackVideo
    - docker-worker:capability:device:kvm
    - docker-worker:capability:privileged
    - docker-worker:feature:allowPtrace
    - generic-worker:feature:allowPtrace
    - index:insert-task:garbage.*
    - notify:email:*
    - purge-cache:{trust_domain}-{level}/*
    - purge-cache:{trust_domain}-t/*
    - queue:get-artifact:project/gecko/*
    - queue:route:index.garbage.*
    - queue:route:notify.*
    - secrets:get:project/taskcluster/gecko/hgfingerprint
    - secrets:get:project/taskcluster/gecko/hgmointernal
    - secrets:get:project/perftest/gecko/level-{level}/*
    - secrets:get:project/releng/gecko/build/windows-laf-tokens.data
  to:
    - projects:
        feature: gecko-roles
        level: [1, 2, 3]

- grant:
    - generic-worker:os-group:gecko-t/t-win7-32/Administrators
    - generic-worker:os-group:gecko-t/t-win7-32-beta/Administrators
    - generic-worker:os-group:gecko-t/t-win10-64/Administrators
    - generic-worker:os-group:gecko-t/t-win10-64-alpha/Administrators
    - generic-worker:os-group:gecko-t/t-win10-64-beta/Administrators
    - generic-worker:os-group:gecko-t/win11-64-2009/Administrators
    - generic-worker:os-group:gecko-t/win11-64-24h2/Administrators
    - generic-worker:os-group:gecko-t/win11-64-2009-alpha/Administrators
    - generic-worker:os-group:gecko-t/win11-64-24h2-alpha/Administrators
    - generic-worker:os-group:gecko-t/t-linux-2204-wayland-experimental/audio
    - generic-worker:os-group:gecko-t/t-linux-2204-wayland-experimental/video
    - generic-worker:os-group:gecko-t/t-linux-2204-wayland-snap/snap_sudo
    - generic-worker:os-group:gecko-t/t-linux-2404-wayland-snap/snap_sudo
    - generic-worker:os-group:gecko-t/t-linux-2404-wayland-relsre/snap_sudo
    - generic-worker:run-as-administrator:gecko-t/t-win10-64
    - generic-worker:run-as-administrator:gecko-t/t-win10-64-alpha
    - generic-worker:run-as-administrator:gecko-t/t-win10-64-beta
    - generic-worker:run-as-administrator:gecko-t/win11-64-2009-alpha
    - generic-worker:run-as-administrator:gecko-t/win11-64-24h2-alpha
    - generic-worker:run-as-administrator:gecko-t/win11-64-2009
    - generic-worker:run-as-administrator:gecko-t/win11-64-24h2
    - generic-worker:run-as-administrator:releng-hardware/win11-64*
    - project:releng:addons.mozilla.org:server:staging
    - project:releng:balrog:action:*
    - project:releng:balrog:channel:*
    - project:releng:balrog:server:dep
    - project:releng:beetmover:action:*
    - project:releng:beetmover:bucket:dep
    - project:releng:beetmover:apt-repo:dep
    - project:releng:beetmover:bucket:dep-partner
    - project:releng:beetmover:bucket:maven-staging
    - project:releng:beetmover:bucket:maven-nightly-staging
    - project:releng:bouncer:action:*
    - project:releng:bouncer:server:staging
    - project:releng:bouncer:server:staging-nazgul
    - project:releng:flathub:firefox:mock
    - project:releng:googleplay:product:fenix:dep
    - project:releng:googleplay:product:focus-android:dep
    - project:releng:microsoftstore:mock
    - project:releng:ship-it:action:create-new-release
    - project:releng:ship-it:action:mark-as-shipped
    - project:releng:ship-it:action:mark-as-started
    - project:releng:ship-it:action:update-product-channel-version
    - project:releng:ship-it:server:staging
    - project:releng:signing:cert:dep-signing
    - project:releng:signing:format:*
    - project:releng:treescript:action:*
    - project:releng:treescript:action:tagging
    - queue:create-task:medium:proj-autophone/*
    - queue:create-task:low:bitbar/gecko-t-*
    - queue:create-task:low:scriptworker-prov-v1/depsigning-mac-v1
    - queue:create-task:low:scriptworker-prov-v1/depsigning-mac-v1-dev
    - queue:get-artifact:releng/partner/*
    # TODO(bug 1824855): move mobile secrets into the gecko namespace
    - secrets:get:project/mobile/firefox-android/android-components/firebase
    - secrets:get:project/mobile/firefox-android/focus-android/firebase
    - secrets:get:project/mobile/firefox-android/fenix/firebase
    - secrets:get:project/mobile/ci/testrail
  to:
    - projects:
        feature: gecko-roles
        level: [1, 2, 3]
        trust_domain: gecko

- grant:
    - generic-worker:allow-rdp:gecko-1/b-win*
    - generic-worker:allow-rdp:gecko-t/t-win*
    - generic-worker:allow-rdp:gecko-1/win*
    - generic-worker:allow-rdp:gecko-t/win*
    - generic-worker:os-group:gecko-t/t-win7-32/Administrators
    - generic-worker:os-group:gecko-t/t-win7-32-beta/Administrators
    - generic-worker:os-group:gecko-t/t-win10-64/Administrators
    - generic-worker:os-group:gecko-t/t-win10-64-alpha/Administrators
    - generic-worker:os-group:gecko-t/t-win10-64-beta/Administrators
    - generic-worker:os-group:gecko-t/win11-64-2009/Administrators
    - generic-worker:os-group:gecko-t/win11-64-2009-alpha/Administrators
    - generic-worker:run-as-administrator:gecko-t/t-win10-64
    - generic-worker:run-as-administrator:gecko-t/t-win10-64-alpha
    - generic-worker:run-as-administrator:gecko-t/t-win10-64-beta
    - generic-worker:run-as-administrator:gecko-t/win11-64-2009-alpha
    - generic-worker:run-as-administrator:gecko-t/win11-64-2009
    - project:releng:addons.mozilla.org:server:staging
    - project:releng:balrog:action:*
    - project:releng:balrog:channel:*
    - project:releng:balrog:server:dep
    - project:releng:beetmover:action:*
    - project:releng:beetmover:bucket:dep
    - project:releng:beetmover:apt-repo:dep
    - project:releng:beetmover:bucket:dep-partner
    - project:releng:beetmover:bucket:maven-staging
    - project:releng:bouncer:action:*
    - project:releng:bouncer:server:staging
    - project:releng:bouncer:server:staging-nazgul
    - project:releng:flathub:firefox:mock
    - project:releng:microsoftstore:mock
    - project:releng:ship-it:action:create-new-release
    - project:releng:ship-it:action:mark-as-shipped
    - project:releng:ship-it:action:mark-as-started
    - project:releng:ship-it:action:update-product-channel-version
    - project:releng:ship-it:server:staging
    - project:releng:signing:cert:dep-signing
    - project:releng:signing:format:*
    - project:releng:treescript:action:*
    - project:releng:treescript:action:tagging
    - queue:create-task:medium:proj-autophone/*
    - queue:create-task:low:bitbar/gecko-t-*
    - queue:create-task:low:scriptworker-prov-v1/depsigning-mac-v1
    - queue:create-task:low:scriptworker-prov-v1/depsigning-mac-v1-dev
    - queue:get-artifact:releng/partner/*
  to:
    - projects:
        feature: gecko-roles
        level: [1, 2, 3]
        trust_domain: gecko
  environments: staging

- grant:
    - project:comm:thunderbird:releng:balrog:action:*
    - project:comm:thunderbird:releng:balrog:server:dep
    - project:comm:thunderbird:releng:beetmover:action:*
    - project:comm:thunderbird:releng:beetmover:bucket:dep
    - project:comm:thunderbird:releng:bouncer:action:*
    - project:comm:thunderbird:releng:bouncer:server:staging
    - project:comm:thunderbird:releng:bouncer:server:staging-nazgul
    - project:comm:thunderbird:releng:ship-it:action:mark-as-shipped
    - project:comm:thunderbird:releng:ship-it:action:mark-as-started
    - project:comm:thunderbird:releng:ship-it:action:update-product-channel-version
    - project:comm:thunderbird:releng:ship-it:server:staging
    - project:comm:thunderbird:releng:signing:cert:dep-signing
    - project:comm:thunderbird:releng:signing:format:*
    - project:comm:thunderbird:releng:treescript:action:push
    - project:comm:thunderbird:releng:treescript:action:tagging
    - project:comm:thunderbird:releng:treescript:action:version_bump
    - queue:create-task:low:scriptworker-prov-v1/tb-depsigning-mac-v1
    - queue:get-artifact:project/comm/*
    - secrets:get:project/comm/thunderbird/releng/build/level-1/*
  to:
    - projects:
        feature: gecko-roles
        level: [1, 2, 3]
        trust_domain: comm

- grant:
    - secrets:get:project/taskcluster/gecko/build/level-2/*
    - secrets:get:project/civet/github-deploy-key
    - queue:get-artifact:project/civet/*
  to:
    - projects:
        feature: gecko-roles
        level: [2, 3]

# moz-tree:level:3:*
- grant:
    - secrets:get:project/taskcluster/gecko/build/level-3/*
    - secrets:get:project/civet/github-deploy-key
    - queue:get-artifact:project/civet/*
  to:
    - projects:
        feature: gecko-roles
        level: [3]

# moz-tree:level:3:gecko
- grant:
    - auth:aws-s3:read-write:tc-gp-private-1d-us-east-1/releng/mbsdiff-cache/
    - notify:slack-channel:*
    - project:releng:addons.mozilla.org:server:production
    - project:releng:signing:cert:nightly-signing
    - project:releng:signing:cert:release-signing
    - project:releng:signing:cert:release-apple-notarization
    - queue:create-task:highest:proj-autophone/*
    - queue:create-task:highest:scriptworker-prov-v1/depsigning-mac-v1
    - queue:create-task:highest:scriptworker-prov-v1/signing-mac-v1
    - queue:create-task:highest:scriptworker-prov-v1/mac-notarization-poller
    - queue:route:index.gecko.heavyprofile.*
    - queue:route:notify.email.release+tcstaging@mozilla.com.
    - queue:route:notify.email.release-automation-notifications@mozilla.com.*
    - secrets:get:project/mobile/firefox-android/fenix/nightly
    - secrets:get:project/mobile/firefox-android/fenix/nightly-simulation
  to:
    - projects:
        feature: gecko-roles
        level: [3]
        trust_domain: gecko

# moz-tree:level:3:comm
- grant:
    # Thunderbird Sheriff's room
    - notify:matrix-room:!TWztIhgqLawNpRBZTC:mozilla.org*
    - queue:create-task:highest:scriptworker-prov-v1/tb-depsigning-mac-v1
    - queue:create-task:highest:scriptworker-prov-v1/tb-signing-mac-v1
    - queue:create-task:highest:scriptworker-prov-v1/tb-mac-notarization-poller
    - secrets:get:project/comm/thunderbird/releng/build/level-3/*
  to:
    - projects:
        feature: gecko-roles
        level: [3]
        trust_domain: comm

# tooltool downloads
- grant:
    - docker-worker:relengapi-proxy:tooltool.download.internal
    - docker-worker:relengapi-proxy:tooltool.download.public
    - project:releng:services/tooltool/api/download/internal
    - project:releng:services/tooltool/api/download/public
    # This cache contains cached downloads from tooltool.  Since tooltool is
    # content-addressible, and verifies hashes on files in the cache, there is no
    # risk of cache poisoning or collisions.
    - docker-worker:cache:tooltool-cache
  to:
    - projects:
        feature: gecko-roles
        level: [1, 2, 3]

- grant:
    # Allow the backfill action to trigger the per-push action that schedules the backfilled tasks.
    - hooks:trigger-hook:project-{trust_domain}/in-tree-action-{level}-backfill/*
  to:
    - projects:
        job: [action:backfill]
        feature: [gecko-roles, gecko-actions]
        level: [1, 2, 3]

##
# project-specific scopes (for esr's to hang onto their old scopes)

- grant:
    - project:releng:balrog:server:beta
    - project:releng:balrog:server:esr
    - project:releng:balrog:server:release
    - project:releng:beetmover:bucket:maven-production
    - project:releng:beetmover:bucket:partner
    - project:releng:beetmover:bucket:release
    - project:releng:beetmover:apt-repo:release
    - project:releng:bouncer:server:production
    - project:releng:bouncer:server:production-nazgul
    - project:releng:googleplay:product:fenix
    - project:releng:googleplay:product:focus-android
    - project:releng:ship-it:server:production
    # XXX `fennec-production-signing` handles beta signing too.
    - project:releng:signing:cert:fennec-production-signing
    # `production-signing` handles mozillaonline signing
    - project:releng:signing:cert:production-signing
    - secrets:get:project/mobile/firefox-android/focus-android/beta
    - secrets:get:project/mobile/firefox-android/focus-android/release
    - secrets:get:project/mobile/firefox-android/fenix/beta
    - secrets:get:project/mobile/firefox-android/fenix/release
    - secrets:get:project/mobile/firefox-android/fenix/beta-mozillaonline
    - secrets:get:project/mobile/firefox-android/fenix/release-mozillaonline
  to:
    - projects:
        job: [action:release-promotion]
        trust_domain: gecko
        level: [3]
        alias: [mozilla-esr128, mozilla-esr115, mozilla-release, mozilla-beta]

- grant:
    - project:releng:googleplay:product:fenix
    - project:releng:googleplay:product:focus-android
  to:
    - projects:
        job: [action:googleplay]
        trust_domain: gecko
        level: [3]
        alias: [mozilla-central]

# pushing RCs to beta
- grant:
    - project:releng:flathub:firefox:stable
    - project:releng:flathub:firefox:beta
  to:
    - projects:
        job: [action:release-promotion]
        trust_domain: gecko
        level: [3]
        alias: [mozilla-release]

- grant:
    - project:releng:flathub:firefox:beta
  to:
    - projects:
        job: [action:release-promotion]
        trust_domain: gecko
        level: [3]
        alias: [mozilla-beta]

- grant:
    - project:releng:microsoftstore:release
  to:
    - projects:
        job: [action:release-promotion]
        trust_domain: gecko
        level: [3]
        alias: [mozilla-release]

- grant:
    - project:releng:microsoftstore:beta
  to:
    - projects:
        job: [action:release-promotion]
        trust_domain: gecko
        level: [3]
        alias: [mozilla-beta]

- grant:
    - project:releng:ship-it:server:production
  to:
    - project:
        job: [cron:daily-releases]
        trust_domain: gecko
        level: [3]
        alias: [mozilla-beta]

- grant:
    - queue:create-task:{priority}:scriptworker-k8s/gecko-3-tree
  to:
    - project:
        job: [cron:l10n-bumper]
        trust_domain: gecko
        level: [3]
        alias: [autoland]

- grant:
    # Allow the scriptworker-canary cron hook to trigger the corresponding action.
    - hooks:trigger-hook:project-{trust_domain}/in-tree-action-{level}-scriptworker-canary/*
  to:
    - project:
        job: [cron:scriptworker-canary]
        trust_domain: gecko
        level: [3]
        alias: [mozilla-central, autoland]

- grant:
    # Allow the scriptworker-canary action to access the trybld-scriptworker key.
    - secrets:get:project/releng/scriptworker/scriptworker-canary-sshkey
  to:
    - project:
        job: [action:scriptworker-canary]
        trust_domain: gecko
        level: [3]
        alias: [mozilla-central, autoland]

- grant:
    # Allow the backfill-all-browsertime cron hook to trigger the backfill action.
    - hooks:trigger-hook:project-{trust_domain}/in-tree-action-{level}-backfill/*
  to:
    - project:
        job: [cron:backfill-all-browsertime]
        trust_domain: gecko
        level: [3]
        alias: [autoland]

- grant:
    - project:comm:thunderbird:releng:balrog:server:esr
  to:
    - project:
        job: [action:release-promotion]
        trust_domain: comm
        level: [3]
        alias: [comm-esr128, comm-esr115]

- grant:
    - project:comm:thunderbird:releng:balrog:server:release
  to:
    - project:
        job: [action:release-promotion]
        trust_domain: comm
        level: [3]
        alias: [comm-release]

- grant:
    - project:comm:thunderbird:releng:balrog:server:beta
  to:
    - project:
        job: [action:release-promotion]
        trust_domain: comm
        level: [3]
        alias: comm-beta

- grant:
    - project:comm:thunderbird:releng:signing:cert:nightly-signing
    - project:comm:thunderbird:releng:signing:cert:release-apple-notarization
  to:
    - project:
        alias: comm-central

- grant:
    - project:comm:thunderbird:releng:signing:cert:release-signing
    - project:comm:thunderbird:releng:signing:cert:release-apple-notarization
  to:
    - project:
        level: [3]
        alias: [comm-esr128, comm-esr115, comm-release, comm-beta]

- grant:
    - project:comm:thunderbird:releng:beetmover:bucket:release
    - project:comm:thunderbird:releng:bouncer:server:production
    - project:comm:thunderbird:releng:bouncer:server:production-nazgul
    - project:comm:thunderbird:releng:ship-it:server:production
  to:
    - project:
        job: [action:release-promotion]
        trust_domain: comm
        level: [3]
        alias: [comm-esr128, comm-esr115, comm-release, comm-beta]

- grant:
    - project:comm:thunderbird:releng:microsoftstore:release
  to:
    - projects:
        job: [action:release-promotion]
        trust_domain: comm
        level: [3]
        alias: [comm-esr128, comm-esr115, comm-release]

- grant:
    - project:comm:thunderbird:releng:microsoftstore:beta
  to:
    - projects:
        job: [action:release-promotion]
        trust_domain: comm
        level: [3]
        alias: [comm-beta]

- grant:
    - project:comm:thunderbird:releng:flathub:stable
  to:
    - projects:
        job: [action:release-promotion]
        trust_domain: comm
        level: [3]
        alias: [comm-esr128, comm-esr115, comm-release]

- grant:
    - project:comm:thunderbird:releng:flathub:beta
  to:
    - projects:
        job: [action:release-promotion]
        trust_domain: comm
        level: [3]
        alias: [comm-beta]

- grant:
    - project:releng:beetmover:bucket:nightly
    - project:releng:balrog:server:nightly
  to:
    - project:
        alias: [oak, cedar, pine, larch]

# grant relman access to trigger mozilla-central & mozilla-releases hooks
# bug 1899553: grant relman access to trigger google play pushes
# bug 1916613: grant relman access to trigger merge-automation actions
- grant:
    - hooks:trigger-hook:project-releng/cron-task-mozilla-central*
    - hooks:trigger-hook:project-releng/cron-task-releases-mozilla*
    - hooks:trigger-hook:project-gecko/in-tree-action-3-googleplay/*
    - hooks:trigger-hook:project-gecko/in-tree-action-3-merge-automation/*
  to:
    - groups:
        - shipit_firefox

- grant:
    # Bug 1523321: Token for mirroring webrender to github
    - secrets:get:project/webrender-ci/wrupdater-github-token
    # Bug 1604686: Token for gfx github sync.
    - secrets:get:gecko/gfx-github-sync/token
    # Bug 1751132: Token for rlbox github sync.
    - secrets:get:gecko/rlbox-github-sync/token
    # focus and fenix nightly builds
    - secrets:get:project/mobile/firefox-android/focus-android/nightly
    - secrets:get:project/mobile/firefox-android/fenix/nightly
  to:
    - project:
        alias: mozilla-central

- grant:
    # Bug 1698511: Sentry API key is stored in this secret
    - secrets:get:project/engwf/gecko/{level}/tokens
  to:
    - project:
        alias: [mozilla-central, try]

- grant:
    # Grant engwf team access to secrets and artifacts for engwf
    - secrets:get:project/engwf/*
    - secrets:set:project/engwf/*
  to:
    - groups:
        - engworkflow

- grant:
    # Bug 1599870
    - secrets:get:project/civet/github-deploy-key
    - queue:get-artifact:project/civet/*
  to:
    - project:
        alias:
          - try

- grant:
    # Bug 1618285 (Updatebot)
    - secrets:get:project/updatebot/2/try-sshkey
    - secrets:get:project/updatebot/2/phabricator-token
    - secrets:get:project/updatebot/2/bugzilla-api-key
    - secrets:get:project/updatebot/2/database-password
    - secrets:get:project/updatebot/2/sentry-url
    - secrets:get:project/updatebot/2/sql-proxy-config
    - queue:get-artifact:project/updatebot/*
    - hooks:trigger-hook:project-gecko/in-tree-action-1-generic/*
  to:
    - project:
        alias:
          - holly
        level: 2

- grant:
    # Bug 1618285 (Updatebot)
    # Only grant the retrigger permission to -central/holly
    - hooks:trigger-hook:project-gecko/in-tree-action-1-generic/*
  to:
    - project:
        alias:
          - mozilla-central
          - holly
        # This ensures that these are not granted to a level 1 repo
        level: [2, 3]

- grant:
    # Bug 1618285 (Updatebot)
    - secrets:get:project/updatebot/3/try-sshkey
    - secrets:get:project/updatebot/3/phabricator-token
    - secrets:get:project/updatebot/3/bugzilla-api-key
    - secrets:get:project/updatebot/3/database-password
    - secrets:get:project/updatebot/3/sentry-url
    - secrets:get:project/updatebot/3/sql-proxy-config
    - queue:get-artifact:project/updatebot/*
  to:
    - project:
        alias:
          - mozilla-central
        level: 3

- grant:
    # Bug 1530376: Add scopes for Code Review bot in CI
    - queue:route:project.relman.codereview.*
  to:
    - project:
        alias: try

- grant:
    # Bug 1800472: Allow try-comm-central to trigger code review bot
    - queue:route:project.relman.codereview.*
  to:
    - project:
        alias: try-comm-central

- grant:
    # Bug 1876393: Allow mozilla-central to trigger tb-rust-update-check on comm-central
    - hooks:trigger-hook:project-releng/cron-task-comm-central/tb-rust-vendor-check
  to:
    - project:
        alias: mozilla-central

##
# Non-gecko tree projects

- grant:
    - docker-worker:feature:allowPtrace
    - queue:create-task:{priority}:releng-hardware/nss-{level}-b-*
    - queue:route:index.docker.images.v1.{alias}.*
    - project:releng:services/tooltool/api/download/internal
    - project:releng:services/tooltool/api/download/public
  to:
    - project:
        trust_domain: nss

- grant:
    # These are public
    - secrets:get:project/taskcluster/gecko/hgfingerprint
    - secrets:get:project/taskcluster/gecko/hgmointernal

    # Allow fetching secrets appropriate to this level
    - secrets:get:project/{trust_domain}/level-{level}/*
    - secrets:get:project/{trust_domain}/level-any/*

    # Allow a sensible scheduler-id
    - queue:scheduler-id:{trust_domain}-level-{level}
    # Allows cancelling tasks with that scheduler-id
    - queue:cancel-task:{trust_domain}-level-{level}/*
    # Allow reruning tasks with that scheduler-id
    - queue:rerun-task:{trust_domain}-level-{level}/*

    # Allow creating tasks on workers associated to the trust-domain
    - queue:create-task:{priority}:{trust_domain}-{level}/*
    - queue:create-task:{priority}:{trust_domain}-t/*
    - queue:create-task:{priority}:releng-hardware/{trust_domain}-b-{level}-*
    - queue:create-task:{priority}:built-in/*
  to:
    - project:
        feature: trust-domain-scopes

- grant:
    # routes to support locating tasks that create specific versions of artifacts
    # (toolchains, etc.)
    - queue:route:index.{trust_domain}.cache.level-{level}.*
    - index:insert-task:{trust_domain}.cache.level-{level}.*

    # allow using worker caches appropriate to this trust domain and level
    - docker-worker:cache:{trust_domain}-level-{level}-*
    - generic-worker:cache:{trust_domain}-level-{level}-*
  to:
    - project:
        feature: trust-domain-scopes
        has_trust_project: false

- grant:
    # routes to support locating tasks that create specific versions of artifacts
    # (toolchains, etc.)
    - queue:route:index.{trust_domain}.v2.{trust_project}.cache.level-{level}.*
    - index:insert-task:{trust_domain}.v2.{trust_project}.cache.level-{level}.*

    # allow fetching secrets appropriate to this level
    - secrets:get:project/{trust_domain}/{trust_project}/level-{level}/*
    - secrets:get:project/{trust_domain}/{trust_project}/level-any/*

    # allow using worker caches appropriate to this trust domain and level
    - docker-worker:cache:{trust_domain}-project-{trust_project}-level-{level}-*
    - generic-worker:cache:{trust_domain}-project-{trust_project}-level-{level}-*
  to:
    - project:
        feature: trust-domain-scopes
        has_trust_project: true

- grant:
    # routes to support locating tasks that create specific versions of artifacts
    # (toolchains, etc.)
    - queue:route:index.{trust_domain}.cache.pr.*
    - index:insert-task:{trust_domain}.cache.pr.*
    # Legacy routes, remove once all projects are on Taskgraph 8+
    - queue:route:index.{trust_domain}.cache.head.*
    - index:insert-task:{trust_domain}.cache.head.*
  to:
    - project:
        job: [pull-request:*]
        feature: trust-domain-scopes
        has_trust_project: false

- grant:
    # routes to support locating tasks that create specific versions of artifacts
    # (toolchains, etc.)
    - queue:route:index.{trust_domain}.v2.{trust_project}.cache.pr.*
    - index:insert-task:{trust_domain}.v2.{trust_project}.cache.pr.*
    # Legacy routes, remove once all projects are on Taskgraph 8+
    - queue:route:index.{trust_domain}.v2.{trust_project}.cache.head.*
    - index:insert-task:{trust_domain}.v2.{trust_project}.cache.head.*
  to:
    - project:
        job: [pull-request:*]
        feature: trust-domain-scopes
        has_trust_project: true

- grant:
    # routes to support indexing by product
    - queue:route:index.{trust_domain}.v2.{alias}.*
    - index:insert-task:{trust_domain}.v2.{alias}.*
  to:
    - project:
        include_pull_requests: false
        feature: trust-domain-scopes

- grant:
    # needed by Github service's auto-cancel feature
    - queue:cancel-task-group:{trust_domain}-level-1/*
    - queue:seal-task-group:{trust_domain}-level-1/*
    # routes to support indexing by product
    - queue:route:index.{trust_domain}.v2.{alias}-pr.*
    - index:insert-task:{trust_domain}.v2.{alias}-pr.*
  to:
    - project:
        job: [pull-request:*]
        feature: trust-domain-scopes

- grant:
    # routes to support reporting to treeherder
    - queue:route:tc-treeherder-stage.{alias}.*
    - queue:route:tc-treeherder.{alias}.*
    - queue:route:tc-treeherder-stage.v2.{alias}.*
    - queue:route:tc-treeherder.v2.{alias}.*
  to:
    - project:
        feature: treeherder-reporting
        include_pull_requests: false

- grant:
    # routes to support reporting to treeherder
    - queue:route:tc-treeherder-stage.v2.{alias}-pr.*
    - queue:route:tc-treeherder.v2.{alias}-pr.*
  to:
    - project:
        job: [pull-request:*]
        feature: treeherder-reporting

- grant:
    - queue:route:tc-treeherder-stage.v2.{alias}-pr.*
    - queue:route:tc-treeherder.v2.{alias}-pr.*
  to:
    - project:
        job: [pr-action:*]
        feature:
          - treeherder-reporting
          - pr-actions

- grant:
    - secrets:get:project/releng/taskgraph/ci
  to:
    - project:
        alias: taskgraph
        job: [action:*, branch:*, pull-request:trusted, release:*]

- grant:
    - secrets:get:project/releng/taskgraph/mozilla-taskgraph/ci
  to:
    - project:
        alias: mozilla-taskgraph
        job: [action:*, branch:*, pull-request:trusted, release:*]

- grant:
    - secrets:get:project/releng/shipit/ci
  to:
    - project:
        alias: shipit

##
# feature-specific roles

- grant:
    - queue:route:index.{trust_domain}.v2.trunk.revision.*
  to:
    - project:
        feature: is-trunk

##
# mozilla roles
#

# Grant everyone in MoCo the ability to create interactive tasks in the
# 'mozilla' trust domain.
- grant:
    - queue:scheduler-id:mozilla-level-1
    - queue:create-task:low:mozilla-1/*
    - queue:create-task:low:mozilla-t/*
    - queue:get-artifact:private/docker-worker/shell.html
    - queue:get-artifact:private/generic-worker/shell.html
  to:
    - groups:
        - team_moco

# FIXME: Bug 1632147 - app-services and glean should be merged under the same
# `trust_domain` so that scopes are bulked together like in the mobile world
#
# - glean specific roles
- grant:
    - queue:create-task:highest:glean-{level}/*
    - queue:route:index.project.glean.cache.level-{level}.*
    # RELENG-798 - until we have a shared trust domain to push toolchain artifacts to
    - queue:get-artifact:project/gecko/mac-sdk/*
    - project:releng:services/tooltool/api/download/internal
    - project:mozilla:{trust_project}:releng:signing:cert:dep-signing
    - project:mozilla:{trust_project}:releng:signing:format:*
    - project:mozilla:{trust_project}:releng:beetmover:action:push-to-maven
    - project:mozilla:{trust_project}:releng:beetmover:bucket:maven-staging
  to:
    - project:
        alias: glean

- grant:
    - project:mozilla:{trust_project}:releng:signing:cert:release-signing
    - project:mozilla:{trust_project}:releng:beetmover:bucket:maven-production
    - queue:route:notify.email.*
  to:
    - project:
        alias: glean
        level: 3
        job: [release:*]

- grant:
    # TODO Bug 1631839: Remove this scope once project has migrated to
    # `index.glean.v2.*`.
    - queue:route:index.project.glean.v2.branch.*
    - queue:route:index.glean.v2.glean.revision.*
  to:
    - project:
        alias: glean
        job: [branch:*, release:*]

- grant:
    # TODO Make glean use the standard cached task routes
    - index:insert-task:project.glean.cache.head.*
    - queue:route:index.project.glean.cache.head.*
    - index:insert-task:project.glean.cache.pr.*
    - queue:route:index.project.glean.cache.pr.*
  to:
    - project:
        alias: glean
        job: [pull-request:*]

# - application-services specific roles
- grant:
    - docker-worker:taskcluster-proxy:tooltool.download.internal
    # This docker worker cache is still used by the old decision task
    - docker-worker:cache:application-services-*
    - project:releng:services/tooltool/api/download/internal
    - queue:create-task:highest:app-services-{level}/*
    - queue:create-task:highest:releng-hardware/applicationservices-b-{level}-osx1015
    - project:mozilla:{trust_domain}:releng:signing:cert:dep-signing
    - project:mozilla:{trust_domain}:releng:signing:format:*
    - project:mozilla:{trust_domain}:releng:beetmover:action:push-to-candidates
    - project:mozilla:{trust_domain}:releng:beetmover:action:direct-push-to-bucket
    - project:mozilla:{trust_domain}:releng:beetmover:action:push-to-maven
    - project:mozilla:{trust_domain}:releng:beetmover:bucket:dep
    - project:mozilla:{trust_domain}:releng:beetmover:bucket:maven-staging
  to:
    - project:
        alias: application-services
    - project:
        alias: staging-application-services

- grant:
    - queue:route:notify.email.*
    - queue:route:notify.slack-channel.*
  to:
    - project:
        alias: application-services

- grant:
    - project:mozilla:{trust_domain}:releng:signing:cert:release-signing
    # TODO In bug 1632147 we will reorganize scriptworker scopes to re-use the
    # `beetmover-maven-phase` once we have a new `trust_project` for this and
    # `glean` project
    - project:mozilla:{trust_domain}:releng:beetmover:bucket:release
    - project:mozilla:{trust_domain}:releng:beetmover:bucket:maven-production
  to:
    - project:
        alias: application-services
        level: 3
        job: [cron:nightly, action:release-promotion]

- grant:
    - queue:route:index.app-services.v2.{alias}.revision.*
    - queue:route:index.project.{alias}.*
    - secrets:get:project/{alias}/symbols-token
  to:
    - project:
        alias: application-services
        level: 3
        job: [action:*, branch:*, cron:nightly]
    - project:
        alias: staging-application-services
        job: [action:*, branch:*, cron:nightly]

- grant:
    - hooks:trigger-hook:project-app-services/in-tree-action-1-generic/*
    - hooks:trigger-hook:project-app-services/in-tree-action-1-release-promotion/*
    - hooks:trigger-hook:project-app-services/in-tree-action-3-generic/*
    - hooks:trigger-hook:project-releng/cron-task-mozilla-application-services/nightly
    - queue:cancel-task:app-services-level-*
    - queue:create-task:highest:app-services-1/*
    - queue:rerun-task:app-services-level-*
    - queue:get-artifact:private/docker-worker/shell.html
    - queue:scheduler-id:app-services-level-*
  to:
    - roles:
        - mozillians-group:application-services
    - groups:
        - shipit_firefox

# - scriptworker specific roles
- grant:
    - secrets:get:repo:github.com/mozilla-releng/scriptworker:coveralls
    - secrets:get:repo:github.com/mozilla-releng/scriptworker:github
  to:
    - project:
        alias: scriptworker
        job: [pull-request:trusted, branch:main, action:*]

# - balrog specific roles
- grant:
    - secrets:get:repo:github.com/mozilla-releng/balrog:coveralls
  to:
    - project:
        alias: balrog
        job: [pull-request:*, branch:main]

- grant:
    - queue:route:index.project.balrog.*
    - queue:route:notify.*
    - secrets:get:repo:github.com/mozilla-releng/balrog:dockerhub
  to:
    - project:
        alias: balrog
        job: [branch:main]

- grant:
    - queue:route:index.project.balrog.*
    - secrets:get:repo:github.com/mozilla-releng/balrog:dockerhub
    # S3 creds are for deploying the UI
    - secrets:get:repo:github.com/mozilla-releng/balrog:s3-prod-app-config
    - secrets:get:repo:github.com/mozilla-releng/balrog:s3-prod-aws-creds
    - secrets:get:repo:github.com/mozilla-releng/balrog:s3-stage-app-config
    - secrets:get:repo:github.com/mozilla-releng/balrog:s3-stage-aws-creds
  to:
    - project:
        alias: balrog
        job: [release:*]

##
# mozilla-releng roles
#

# Grant these for all releng repos on github
- grant:
    - notify:email:*
    - notify:irc-channel:*
    - notify:irc-user:*
    - queue:route:garbage.*
    - queue:route:index.garbage.*
    - queue:route:notify.email.*
    - queue:route:notify.irc-channel.*
    - queue:route:notify.irc-user.*
    - queue:scheduler-id:taskcluster-github
    - queue:create-task:{priority}:{trust_domain}-{level}/*
    - queue:create-task:{priority}:{trust_domain}-t/*
  to:
    - project:
        trust_domain: releng

# - fxci-config specific roles
- grant:
    # We grant a client for Taskcluster stage so `fxci-config` PRs can
    # deploy themselves there for testing.
    - secrets:get:project/releng/fxci-config/taskcluster-stage-client
  to:
    - project:
        alias: fxci-config
        job: [pull-request:trusted]

- grant:
    # We grant ability to create `gecko-t` tasks in the staging instance so we
    # can validate image changes before they land.
    - queue:create-task:{priority}:gecko-t/*
  to:
    - project:
        alias: fxci-config
        job: [pull-request:trusted]
  environment: staging

# - k8s-autoscale roles
- grant:
    - secrets:get:project/releng/k8s-autoscale/deploy
  to:
    - project:
        alias: k8s-autoscale
        job: [branch:dev, branch:master, branch:production]

# - cloud-image-builder specific roles
- grant:
    - auth:create-role:worker-pool:gecko-1/win*
    - auth:create-role:worker-pool:gecko-t/win*
    - auth:sentry:generic-worker
    - auth:update-role:worker-pool:gecko-1/win*
    - auth:update-role:worker-pool:gecko-t/win*
    - auth:websocktunnel-token:cloudopsstage/*
    - auth:websocktunnel-token:firefoxcitc/*
    - queue:route:index.project.relops.*
    - generic-worker:os-group:*
    - generic-worker:run-as-administrator:*
    - queue:create-task:{priority}:gecko-1/win*
    - queue:create-task:{priority}:gecko-1/b-win*
    - queue:create-task:{priority}:gecko-t/win*
    - queue:create-task:{priority}:gecko-t/t-win*
    - queue:create-task:{priority}:relops*
    - secrets:get:project/relops/image-builder*
    - secrets:get:project/relops/image-deploy*
    - queue:scheduler-id:taskcluster-github
    - worker-manager:manage-worker-pool:gecko-1/win*
    - worker-manager:manage-worker-pool:gecko-1/b-win*
    - worker-manager:manage-worker-pool:gecko-t/win*
    - worker-manager:manage-worker-pool:gecko-t/t-win*
    - worker-manager:manage-worker-pool:relops*
    - worker-manager:provider:aws
    - worker-manager:provider:azure
  to:
    - project:
        alias: cloud-image-builder
        job: [branch:main]
  environment: staging

# - product-details specific roles
- grant:
    - secrets:get:repo:github.com/mozilla-releng/product-details:branch:production
  to:
    - projects:
        alias: product-details
        job: [branch:production]

- grant:
    - secrets:get:repo:github.com/mozilla-releng/product-details:branch:staging
  to:
    - projects:
        alias: product-details
        job: [branch:staging]

- grant:
    - secrets:get:repo:github.com/mozilla-releng/product-details:branch:testing
  to:
    - projects:
        alias: product-details
        job: [branch:testing]

# - shipit specific roles
- grant:
    - secrets:get:project/releng/shipit/deploy
  to:
    - projects:
        alias: shipit
        job: [branch:production, branch:dev]

# - tooltool specific roles
- grant:
    - secrets:get:project/releng/tooltool/ci
  to:
    - projects:
        alias: tooltool
        job: [branch:*, pull-request:*]

- grant:
    - secrets:get:project/releng/tooltool/deploy
  to:
    - projects:
        alias: tooltool
        job: [branch:dev, branch:staging, branch:production]

# generic github checks
- grant:
    - queue:route:checks
  to:
    - project:
        repo_type: [git]
        job: ["*"]

##
# mobile-specific roles
#
# We refer to level 1 as the staging/development workflow for a given project
# (e.g. pull/requests and staging-triggered releases) while level 3 defines the
# production releases (Github-based releases or triggered via hooks)
#

# mobile:level:X:*
- grant:
    - queue:create-task:highest:mobile-{level}/*
    - queue:create-task:highest:mobile-t/*
    - queue:create-task:{priority}:built-in/*
    - queue:get-artifact:mobile/android-sdk/*
    - queue:route:notify.*
    - notify:email:*
    - notify:slack-channel:*
    - project:mobile:{trust_project}:releng:signing:cert:dep-signing
    - project:mobile:{trust_project}:releng:signing:format:*
    # TODO Legacy non-project trust-domain scopes. Unless there is good reason
    # to share across projects, these should be vetted and removed once no more
    # tasks are using them.
    - index:insert-task:mobile.cache.level-{level}.*
    - queue:route:index.mobile.cache.level-{level}.*
  to:
    - project:
        feature: mobile-roles

- grant:
    - secrets:get:project/releng/mobile/github-cron-token
  to:
    - project:
        repo_type: [git]
        job: [cron:*]

- grant:
    # These tokens are considered public because they're available to Pull Requests. We need them
    # there because we want coverage reports.
    - secrets:get:project/mobile/{trust_project}/public-tokens
  to:
    - project:
        feature: mobile-public-code-coverage

- grant:
    - project:{trust_domain}:{trust_project}:releng:beetmover:action:push-to-maven
  to:
    - project:
        feature: beetmover-maven-phase
        job: [pull-request:*, action:release-promotion]
    - project:
        feature: beetmover-maven-nightly-phase
        job: [cron:nightly]

- grant:
    - project:{trust_domain}:{trust_project}:releng:beetmover:bucket:maven-production
  to:
    - project:
        feature: beetmover-maven-phase
        level: 3
        job: [action:release-promotion]

- grant:
    - project:{trust_domain}:{trust_project}:releng:beetmover:bucket:maven-staging
    - project:{trust_domain}:{trust_project}:releng:beetmover:bucket:maven-nightly-staging
  to:
    - project:
        feature: beetmover-maven-phase
        level: 1
        job: [action:release-promotion, cron:nightly]
    - project:
        feature: beetmover-maven-phase
        job: [pull-request:*]

- grant:
    - project:{trust_domain}:{trust_project}:releng:beetmover:bucket:maven-nightly-production
  to:
    - project:
        feature: beetmover-maven-nightly-phase
        level: 3
        job: [cron:nightly]

- grant:
    - project:{trust_domain}:{trust_project}:releng:beetmover:bucket:dep
    - project:{trust_domain}:{trust_project}:releng:beetmover:action:direct-push-to-bucket
  to:
    - project:
        feature: beetmover-phase
        job: [pull-request:*]
    - project:
        feature: beetmover-phase
        level: 1
        job: [action:release-promotion, cron:nightly]

- grant:
    - project:{trust_domain}:{trust_project}:releng:beetmover:action:direct-push-to-bucket
    - project:{trust_domain}:{trust_project}:releng:beetmover:bucket:nightly
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-{level}-*
  to:
    - project:
        feature: beetmover-phase
        level: 3
        job: [cron:nightly]

- grant:
    - project:{trust_domain}:{trust_project}:releng:beetmover:action:direct-push-to-bucket
    - project:{trust_domain}:{trust_project}:releng:beetmover:bucket:release
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-{level}-*
  to:
    - project:
        feature: beetmover-phase
        level: 3
        job: [action:release-promotion]

- grant:
    - project:{trust_domain}:{alias}:treescript:action:*
  to:
    - project:
        feature: treescript-phase
        job: [action:release-promotion]

- grant:
    - project:{trust_domain}:{trust_project}:releng:github:action:release
  to:
    - project:
        feature: github-publication
        job: [action:release-promotion, pull-request:*]

- grant:
    - project:{trust_domain}:{trust_project}:releng:github:project:{alias}
  to:
    - project:
        feature: github-publication
        job: [action:release-promotion]

- grant:
    - project:{trust_domain}:{trust_project}:releng:github:project:mock
  to:
    - project:
        feature: github-publication
        level: 1
        job: [action:release-promotion]
    - project:
        feature: github-publication
        job: [pull-request:*]

- grant:
    - secrets:get:project/releng/releng-github-clone-ssh
  to:
    - project:
        feature: github-private-repo

- grant:
    - project:mobile:{trust_project}:releng:signing:cert:release-signing
  to:
    - project:
        feature: mobile-sign-phase
        level: 3
        job: [cron:nightly, action:release-promotion]

- grant:
    - queue:route:index.mobile.v2.{trust_project}.nightly.*
  to:
    - project:
        feature: mobile-sign-phase
        level: 3
        job: [cron:nightly]

- grant:
    - project:mobile:{trust_project}:releng:googleplay:product:{trust_project}
  to:
    - project:
        feature: mobile-pushapk-phase
        level: 3
        job:
          - cron:nightly
          - action:release-promotion

- grant:
    - project:mobile:{trust_project}:releng:googleplay:product:{trust_project}:dep
  to:
    - project:
        feature: mobile-pushapk-phase
        job: [pull-request:*]
    - project:
        feature: mobile-pushapk-phase
        level: 1
        job:
          - cron:*
          - action:release-promotion

- grant:
    - secrets:get:project/mobile/{trust_project}/firebase
  to:
    - project:
        alias: reference-browser
        job:
          - action:*
          - branch:*
          - pull-request:trusted

- grant:
    - secrets:get:project/mobile/github
  to:
    - project:
        feature: mobile-bump-github
        level: 3
        job: [cron:bump-*]

- grant:
    - project:mobile:{trust_project}:releng:signing:cert:dep-signing
    - queue:create-task:highest:proj-autophone/gecko-t-ap-perf-g5
    - queue:create-task:highest:proj-autophone/gecko-t-ap-perf-p2
    - queue:create-task:highest:proj-autophone/gecko-t-bitbar-gw-perf-g5
    - queue:create-task:highest:proj-autophone/gecko-t-bitbar-gw-perf-p2
    - queue:create-task:highest:proj-autophone/gecko-t-bitbar-gw-perf-a51
  to:
    - project:
        feature: autophone
        job:
          - action:*
          - pull-request:*
    - project:
        alias: reference-browser
        job: [branch:*]

- grant:
    - queue:route:index.{trust_domain}.v2.{trust_project}.performance-test.*
  to:
    - project:
        alias: reference-browser
        job: [branch:master]

- grant:
    - queue:route:notify.email.perftest-alerts@mozilla.com.on-failed
  to:
    - project:
        alias: reference-browser
        job: [branch:master]

- grant:
    - project:{trust_domain}:releng:ship-it:action:mark-as-shipped
  to:
    - project:
        feature: shipit
        job: [pull-request:*]
    - project:
        feature: [shipit, taskgraph-actions]
        job: [action:release-promotion]

- grant:
    - project:{trust_domain}:releng:ship-it:server:production
  to:
    - project:
        level: 3
        feature: [shipit, taskgraph-actions]
        job: [action:release-promotion]

- grant:
    - project:{trust_domain}:releng:ship-it:server:staging
  to:
    - project:
        # TODO: once pull-request-based staging releases are more stable and
        # available for all mobile projects, we can get rid of this `level=1`
        # section which addresses the RelEngers forks
        level: 1
        feature: shipit
        job: [pull-request:*]
    - project:
        level: 1
        feature: [shipit, taskgraph-actions]
        job: [action:release-promotion]
    - project:
        level: 3
        feature: [shipit, taskgraph-actions]
        job: [pull-request:*]

- grant:
    - queue:scheduler-id:{trust_domain}-level-{level}
    # allow using worker caches appropriate to this trust domain and level
    - docker-worker:cache:{trust_domain}-level-{level}-*
    - generic-worker:cache:{trust_domain}-level-{level}-*
  to:
    - project:
        feature: github-taskgraph

- grant:
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-{level}-*
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-t-*
  to:
    - project:
        feature: scriptworker

# reference-browser specific scopes
- grant:
    - secrets:get:project/mobile/reference-browser/nightly
  to:
    - projects:
        alias:
          - reference-browser
        job: [branch:*, cron:nightly]

- grant:
    - secrets:get:project/mobile/reference-browser/nimbledroid
    - secrets:get:project/mobile/reference-browser/sentry
    - queue:route:notify.email.android-components-team@mozilla.com.on-failed
  to:
    - project:
        alias: reference-browser
        job: [cron:nightly]

# firefox-ios specific scopes
- grant:
    - secrets:get:project/mobile/firefox-ios/bitrise
  to:
    - project:
        alias: firefox-ios
        job:
          - action:*
          - cron:l10-screenshots
          - cron:bitrise-performance-test
          - cron:firebase-performance-test
          - branch:*

# Bug 1915421 - Granted for experimentation, remove when finished
- grant:
    - queue:create-task:{priority}:releng-hardware/mozilla-b-1-osx
  to:
    - project:
        alias: firefox-ios
        job:
          - pull-request:trusted
    - project:
        alias: staging-firefox-ios
        job:
          - action:*
          - cron:*
          - branch:*
          - pull-request:trusted

# bitrisescript grants
- grant:
    - project:{trust_domain}:{trust_project}:releng:bitrise:app:{alias}
    # Explicitly approve workflows rather than use a wildcard. This guards
    # against potentially sensitive workflows being added in the future that
    # would then implicitly be allowed in places they shouldn't be.
    - project:{trust_domain}:{trust_project}:releng:bitrise:workflow:Bitrise_Performance_Test
    - project:{trust_domain}:{trust_project}:releng:bitrise:workflow:build_and_test_*
    - project:{trust_domain}:{trust_project}:releng:bitrise:workflow:L10nBuild
    - project:{trust_domain}:{trust_project}:releng:bitrise:workflow:L10nScreenshotsTests
    - project:{trust_domain}:{trust_project}:releng:bitrise:workflow:Firebase_Performance_Test
    - project:{trust_domain}:{trust_project}:releng:bitrise:workflow:firefox_configure_build
    - project:{trust_domain}:{trust_project}:releng:bitrise:workflow:focus_configure_build
    - project:{trust_domain}:{trust_project}:releng:bitrise:workflow:focus_ui_test
    - project:{trust_domain}:{trust_project}:releng:bitrise:workflow:focus_unit_test
    - project:{trust_domain}:{trust_project}:releng:bitrise:workflow:klar_unit_test
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-{level}-*
  to:
    - project:
        alias:
          - firefox-ios
          - staging-firefox-ios
        job:
          - action:*
          - cron:*
          - branch:*
          - pull-request:trusted

- grant:
    - secrets:get:project/mobile/ci/testrail
  to:
    - project:
        feature: mobile-testrail
        job:
          - action:*
          - cron:*
          - branch:*
          - pull-request:trusted

# Mozilla VPN

- grant:
    - queue:create-task:{priority}:scriptworker-prov-v1/mozillavpn-{level}-*
    # TODO: remove extraneous 'mozillavpn' from this route
    - queue:route:index.{trust_domain}.v2.mozillavpn.cache.level-{level}.*
    - queue:route:notify.email.*
    - queue:get-artifact:project/mozillavpn/*
  to:
    - project:
        alias:
          - mozilla-vpn-client
        job:
          - branch:*
          - cron:*
          - pull-request:*
          - release:*
          - action:*

- grant:
    - index:insert-task:{trust_domain}.v2.mozillavpn.cache.pr.*
    - queue:route:index.{trust_domain}.v2.mozillavpn.cache.pr.*
    # TODO: Remove below once all mozilla-vpn-client release branches are using
    # Taskgraph 8+
    - index:insert-task:{trust_domain}.v2.mozillavpn.cache.head.*
    - queue:route:index.{trust_domain}.v2.mozillavpn.cache.head.*
  to:
    - project:
        alias:
          - mozilla-vpn-client
          - staging-mozilla-vpn-client
        job: [pull-request:*]

- grant:
    - project:mozillavpn:releng:beetmover:apt-repo:release
    - project:mozillavpn:releng:beetmover:action:import-from-gcs-to-artifact-registry
    - project:mozillavpn:releng:beetmover:action:push-to-candidates
    - project:mozillavpn:releng:beetmover:bucket:release
  to:
    - project:
        alias:
          - mozilla-vpn-client
        job: [release:*, action:release-promotion]

- grant:
    - project:mozillavpn:releng:beetmover:action:push-to-releases
    - project:mozillavpn:releng:beetmover:action:direct-push-to-bucket
    # Temporary until we stop using `dep` beetmover for production vpn releases
    # in the promote phase.
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-1-*
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-{level}-*
    - queue:route:notify.slack-channel.C01DCUKG95E.*  # mozilla-vpn-release
    - "queue:route:notify.matrix-room.!tBWwNyfeKqGvkNpdDL:mozilla.org.*"  # releaseduty
  to:
    - project:
        alias:
          - mozilla-vpn-client
        job: [action:release-promotion]

- grant:
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-{level}-*
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-t-*
    - queue:create-task:highest:scriptworker-prov-v1/{trust_domain}-t-*
    - project:mozillavpn:releng:beetmover:action:push-to-candidates
    - project:mozillavpn:releng:beetmover:bucket:dep
    - project:mozillavpn:releng:beetmover:action:import-from-gcs-to-artifact-registry
    - project:mozillavpn:releng:beetmover:apt-repo:dep
    - project:mozillavpn:releng:signing:cert:dep-signing
  to:
    - project:
        alias:
          - mozilla-vpn-client

- grant:
    - project:{trust_domain}:releng:signing:format:*
    - project:releng:services/tooltool/api/download/public
    - project:releng:services/tooltool/api/download/internal
    - secrets:get:project/mozillavpn/level-1/*
  to:
    - project:
        alias: mozilla-vpn-client
        job:
          - action:*
          - branch:*
          - pull-request:trusted
          - release:*

- grant:
    - project:mozillavpn:releng:googleplay:product:mozillavpn
  to:
    - project:
        alias:
          - mozilla-vpn-client
        job: [release:*]

- grant:
    - queue:route:index.{trust_domain}.v2.{alias}.release.*
  to:
    - project:
        alias:
          - mozilla-vpn-client
          - staging-mozilla-vpn-client
        job: [release:*, action:release-promotion]

- grant:
    - project:mozillavpn:releng:signing:cert:release-signing
    - project:mozillavpn:releng:signing:cert:release-apple-notarization
    - secrets:get:project/mozillavpn/tokens
  to:
    - project:
        alias:
          - mozilla-vpn-client
        # Only enable this for main and release branches, so that in-repo branches
        # don't get access to release signing.
        job:
          - branch:main
          - branch:releases/*
          - release:*

- grant:
    - queue:route:index.{trust_domain}.v2.mozilla-vpn-client.branch.*
  to:
    - project:
        alias:
          - mozilla-vpn-client
        # Only enable this for main and release branches, so that in-repo branches
        # don't get access to release signing.
        job:
          - branch:main
          - branch:releases/*

- grant:
    - queue:route:index.{trust_domain}.v2.mozillavpn.cache.level-1.*
    - queue:route:tc-treeherder.v2.{alias}.*
    - queue:create-task:project:none
  to:
    - project:
        alias: staging-mozilla-vpn-client

- grant:
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-t-*
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-1-*
    - queue:create-task:low:releng-hardware/mozillavpn-b-1-*
    - queue:create-task:low:scriptworker-prov-v1/mozillavpn-t-signing-mac
    - queue:create-task:highest:scriptworker-prov-v1/vpn-depsigning-mac-v1
    - project:mozillavpn:releng:beetmover:action:push-to-candidates
    - project:mozillavpn:releng:beetmover:action:push-to-releases
    - project:mozillavpn:releng:beetmover:action:direct-push-to-bucket
    - project:mozillavpn:releng:beetmover:action:copy-artifacts
    - project:mozillavpn:releng:beetmover:bucket:dep
    - project:mozillavpn:releng:beetmover:action:import-from-gcs-to-artifact-registry
    - project:mozillavpn:releng:beetmover:apt-repo:dep
    - project:mozillavpn:releng:signing:cert:dep-signing
    - project:mozillavpn:releng:signing:format:*
    - project:releng:services/tooltool/api/download/public
    - project:releng:services/tooltool/api/download/internal
  to:
    - project:
        alias:
          - staging-mozilla-vpn-client
        job:
          - branch:*
          - pull-request:trusted
          - release:*
          - action:release-promotion

- grant:
    - secrets:get:project/mozillavpn/tokens
    - secrets:get:project/mozillavpn/level-1/*
  to:
    - project:
        alias:
          - staging-mozilla-vpn-client
        job:
          - branch:main
          - branch:releases/*
          - release:*

- grant:
    - "queue:route:notify.matrix-room.!wGgsWXnVncJLSBYmuf:mozilla.org.*"  # releaseduty-dev
  to:
    - project:
        alias: [staging-mozilla-vpn-client]
        job: [action:release-promotion]

# Bug 1745945: secret scopes for mozillavpn-developers
- grant:
    - hooks:trigger-hook:project-mozillavpn/in-tree-action-1-generic/*
    - hooks:trigger-hook:project-mozillavpn/in-tree-action-1-release-promotion/*
    - hooks:trigger-hook:project-mozillavpn/in-tree-action-3-generic/*
    - secrets:set:project/mozillavpn/*
    - secrets:get:project/mozillavpn/*
    - queue:rerun-task:mozillavpn-level-*
  to:
    - roles:
        - mozillians-group:mozillavpn-developers

# XPI

- grant:
    - project:xpi:releng:github:project:mozilla-releng/staging-xpi-*
    - project:xpi:releng:github:action:release
    - project:xpi:releng:signing:cert:dep-signing
    - project:xpi:beetmover:action:*
    - project:xpi:beetmover:bucket:dep
    - project:xpi:balrog:action:*
    - project:xpi:balrog:channel:*
    - project:xpi:balrog:server:staging
    - queue:create-task:highest:xpi-{level}/*
    - queue:create-task:highest:xpi-t/*
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-{level}-*
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-t-*
    - queue:route:index.{trust_domain}.v2.xpi-manifest.*
    - queue:route:index.xpi.cache.level-{level}.*
  to:
    - project:
        alias:
          - xpi-manifest
          - staging-xpi-manifest
        # Only enable this for main and actions.
        # TODO: Remove "master" once fully switched to "main"
        job: [branch:main, action:*]

- grant:
    - project:xpi:releng:github:project:mozilla-extensions/*
    - project:xpi:releng:github:project:mozilla-rally/rally-core-addon
    - project:xpi:releng:signing:cert:release-signing
    - project:xpi:beetmover:bucket:release
    - project:xpi:balrog:server:release
  to:
    - project:
        alias:
          - xpi-manifest
        # Only enable this for main and actions.
        # TODO: Remove "master" once fully switched to "main"
        job: [branch:main, action:*]

- grant:
    # access to workers; all levels have access to the same workers, but at
    # different priorities and levels
    - queue:route:index.xpi.xpi-manifest.cache.level-1.*
    - queue:route:index.xpi.v2.*
    - queue:route:index.xpi.cache.level-1.*
    - queue:route:index.xpi.cache.pr.*
    - queue:route:checks
    - queue:scheduler-id:taskcluster-github
    - queue:route:notify.email.*
    - queue:create-task:low:built-in/*
    - queue:create-task:low:xpi-1/*
    - queue:create-task:low:xpi-t/*
    - queue:get-artifact:xpi/*
    - queue:scheduler-id:xpi-level-1
    - queue:cancel-task-group:xpi-level-1/*
    - queue:seal-task-group:xpi-level-1/*
    - docker-worker:cache:xpi-level-1-*
    - secrets:get:project/xpi/xpi-github-clone-ssh
    - project:xpi:releng:signing:cert:dep-signing
    - queue:create-task:low:scriptworker-k8s/xpi-t-*
  to:
    - project:
        feature: xpi-roles
        job: [pull-request:*, branch:*, cron:*, action:*, tag:*]
    - roles:
        # The mozilla-extensions github organization is designed to allow for
        # easily creating new repos for xpi source. Let's automatically
        # give them level 1 scopes for master, PRs, and other branches.
        - repo:github.com/mozilla-extensions/*
        - repo:github.com/mozilla-releng/staging-xpi-*

- grant:
    - queue:get-artifact:xpi/*
  to:
    - groups:
        - team_moco
        - team_mozillaonline

- grant:
    - in-tree:hook-action:project-{trust_domain}/in-tree-action-{level}-*
  to:
    - project:
        feature: taskgraph-actions

- grant:
    - in-tree:hook-action:project-{trust_domain}/in-tree-pr-action-{level}-*
  to:
    - project:
        feature: pr-actions
        job: [pull-request:*]

# Adhoc signing

- grant:
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-t-*
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-{level}-*
    - queue:create-task:highest:scriptworker-prov-v1/{trust_domain}-t-*
    - queue:create-task:highest:scriptworker-prov-v1/{trust_domain}-{level}-*
    - queue:create-task:highest:adhoc-{level}/*
    - queue:create-task:highest:adhoc-t/*
    - queue:create-task:highest:scriptworker-prov-v1/{trust_domain}-signing-mac-dev
    - queue:create-task:highest:scriptworker-prov-v1/{trust_domain}-{level}-*
    - project:adhoc:releng:signing:cert:dep-signing
    - queue:route:index.{trust_domain}.v2.{alias}.*
    - queue:route:index.{trust_domain}.v2.staging-adhoc-manifest.*
    - queue:route:index.adhoc-signing.cache.level-{level}.*
    - queue:get-artifact:releng/adhoc/*
    - queue:route:notify.email.*
  to:
    - project:
        feature: adhoc-roles
        job: [branch:*, action:*, pull-request:trusted, action:*, cron:*]

- grant:
    - project:adhoc:releng:signing:cert:release-signing
    - project:adhoc:releng:signing:cert:release-apple-notarization
    - project:adhoc:releng:signing:cert:nightly-signing
    - queue:route:index.{trust_domain}.v2.adhoc-manifest.*
  to:
    - project:
        alias:
          - adhoc-signing
        # Only enable this for master and actions.
        job: [branch:master, action:*]

# Scriptworker and scriptworker-scripts
- grant:
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-t-*
    - queue:create-task:highest:scriptworker-{level}/*
    - queue:create-task:highest:scriptworker-t/*
    - queue:create-task:highest:scriptworker-k8s/{trust_domain}-t-*
    - queue:route:index.{trust_domain}.v2.{alias}.*
    - queue:route:index.scriptworker.cache.level-{level}.*
    # explicitly grant level 1 scopes for PRs
    - queue:scheduler-id:scriptworker-level-1
    - queue:create-task:highest:scriptworker-1/*
    - queue:route:index.scriptworker.cache.level-1.*
  to:
    - project:
        alias:
          - scriptworker-scripts
        job: [branch:*, action:*, pull-request:*, action:*, cron:*]

# - scriptworker-scripts specific roles
# XXX delete these once we port scriptworker-scripts cloudops deploys to CoT
#     downloads
- grant:
    - secrets:get:project/releng/scriptworker-scripts/deploy
  to:
    - projects:
        alias: scriptworker-scripts
        job: [branch:production*, branch:dev*]


##
# delegate cron:nightly-* to hand-managed nightly roles
#
- grant:
    - project:releng:balrog:channel:nightly
    - project:releng:balrog:server:nightly
    - project:releng:beetmover:bucket:dep
    - project:releng:beetmover:bucket:nightly
    - project:releng:beetmover:apt-repo:nightly
    - project:releng:beetmover:bucket:maven-production
    - project:releng:beetmover:bucket:maven-nightly-production
    - project:releng:bouncer:server:production
    - project:releng:bouncer:server:production-nazgul
    - project:releng:googleplay:product:fenix
    - project:releng:googleplay:product:focus-android
    - project:releng:ship-it:server:production
    - project:releng:signing:cert:nightly-signing
    - project:releng:signing:cert:release-apple-notarization
    - project:releng:signing:cert:production-signing
  to:
    - project:
        feature: gecko-cron
        alias: mozilla-central
        trust_domain: gecko
        job: cron:nightly-*

- grant:
    - assume:project:comm:thunderbird:comm:releng:nightly:level-{level}:{alias}
    - project:comm:thunderbird:releng:balrog:server:nightly
    - project:comm:thunderbird:releng:beetmover:bucket:nightly
    - project:comm:thunderbird:releng:bouncer:server:production
    - project:comm:thunderbird:releng:ship-it:server:production
    - project:comm:thunderbird:releng:signing:cert:nightly-signing
    - project:comm:thunderbird:releng:signing:cert:release-apple-notarization
  to:
    - project:
        alias: comm-central
        feature: gecko-cron
        trust_domain: comm
        job: cron:nightly-*

- grant:
    - project:releng:beetmover:bucket:maven-production
  to:
    - project:
        # We still support RELBRANCHes on mozilla-release. Geckoview gets automatically shipped on
        # GECKOVIEW_\d+_RELBRANCH (\d+ being the major version)
        alias: mozilla-release
        # /!\ Relbranches currently use `branch:default`
        job: branch:*

##
# Administrative Scopes

- grant:
    # Allow sheriffs to quarantine gecko related workers
    - queue:quarantine-worker:bitbar/gecko-*
    - queue:quarantine-worker:gecko-1/*
    - queue:quarantine-worker:gecko-3/*
    - queue:quarantine-worker:gecko-t/*
    - queue:quarantine-worker:proj-autophone/gecko-*
    - queue:quarantine-worker:releng-hardware/gecko-*
    - queue:quarantine-worker:releng-hardware/win11-64-2009-hw/mdc1/*
    - queue:quarantine-worker:mobile-*
    # Allow sheriffs to terminate gecko/mobile related workers
    - worker-manager:remove-worker:gecko-*
    - worker-manager:remove-worker:mobile-*
    # Allow triggering nightlies
    - hooks:trigger-hook:project-releng/cron-task-mozilla-central/nightly-*
    # Allow sheriffs to force schedule a decision task, whenever one has gone
    # missing because of a bustage
    - hooks:trigger-hook:hg-push/*
  to:
    - groups:
        - sheriff
        - perf_sheriff

- grant:
    - queue:cancel-task:gecko-level-*
    - queue:rerun-task:gecko-level-*
  to:
    - groups:
        - perf_sheriff
        - sheriff
        # People who trigger firefox releases should be able to cancel/rerun (release) tasks
        - shipit_firefox

- grant:
    # Allow triggering geckoview, bumps, nightlies and l10n tasks
    - hooks:trigger-hook:project-releng/cron-task-integration-autoland/android-l10n-import
    - hooks:trigger-hook:project-releng/cron-task-releases-mozilla-beta/android-l10n-sync

    - hooks:trigger-hook:project-releng/cron-task-mozilla-mobile-reference-browser/nightly
    - hooks:trigger-hook:project-releng/cron-task-mozilla-mobile-reference-browser/bump-android-comp

    - hooks:trigger-hook:project-releng/cron-task-mozilla-mobile-firefox-ios/l10-screenshots
    - hooks:trigger-hook:project-releng/cron-task-mozilla-mobile-firefox-ios/bitrise-performance-test
    - hooks:trigger-hook:project-releng/cron-task-mozilla-mobile-firefox-ios/firebase-performance-test

    - queue:rerun-task:mobile-level-*
  to:
    - groups:
        - sheriff
        - mobile_releases
        - mobile_eng_ops

- grant:
    # Allow to manage mobile trees
    - queue:cancel-task:taskcluster-github/*
    - queue:cancel-task:mobile-level-*
    - queue:rerun-task:mobile-level-*
    - hooks:trigger-hook:project-mobile/in-tree-action-1-generic/*
    - hooks:trigger-hook:project-mobile/in-tree-action-3-generic/*
  to:
    - groups:
        - sheriff
        - perf_sheriff
        - mobile_releases
        - mobile_eng_ops
        - mobile_test_ops

- grant:
    # Allow connecting to interactive mobile tasks
    - queue:get-artifact:mobile/android-sdk/*
    - queue:scheduler-id:mobile-level-1
    - queue:create-task:low:mobile-1/*
  to:
    - groups:
        - mobile_eng_ops

- grant:
    # Allow people with level-3 access to access interactive tasks
    - queue:get-artifact:private/interactive/*
    - queue:get-artifact:private/docker-worker/*
  to:
    - groups:
        - active_scm_level_3
        - mobile_eng_ops

- grant:
    # Allow triggering thunderbird nightlies
    - hooks:trigger-hook:project-releng/cron-task-comm-central/nightly-*
    # Bug 1876393: Allow triggering tb-rust-update-check on comm-central
    - hooks:trigger-hook:project-releng/cron-task-comm-central/tb-rust-vendor-check
  to:
    - groups:
        - thunderbird-sheriff
        - thunderbird-releng

- grant:
    # Additional permissions for thunderbird-releng:
    # adds merge-automation, release-promotion, purge-caches, retrigger-decision
    # Merge Day Automation
    - hooks:trigger-hook:project-comm/in-tree-action-*
    # Allow cancel
    - queue:cancel-task:comm-level-*
    # Allow rerun
    - queue:rerun-task:comm-level-*
  to:
    - groups:
        - thunderbird-releng

- grant:
    # permission to run Taskcluster's smoketests.
    - auth:create-client:project/taskcluster/smoketest/*
    - auth:create-role:project:taskcluster:smoketest:*
    - auth:delete-client:project/taskcluster/smoketest/*
    - auth:delete-role:project:taskcluster:smoketest:*
    - auth:reset-access-token:project/taskcluster/smoketest/*
    - auth:update-client:project/taskcluster/smoketest/*
    - auth:update-role:project:taskcluster:smoketest:*
    - project:taskcluster:smoketest:*
    - purge-cache:built-in/succeed:smoketest-cache
    - queue:create-task:highest:built-in/*
    - queue:create-task:highest:built-in/fail
    - queue:create-task:highest:built-in/succeed
    - queue:route:index.project.taskcluster.smoketest.*
    - queue:scheduler-id:smoketest
    - secrets:get:project/taskcluster/smoketest/*
    - secrets:set:project/taskcluster/smoketest/*
  to:
    - roles:
        - project:taskcluster:smoketests

- grant:
    - assume:project:taskcluster:smoketests
  to:
    - groups:
        - team_taskcluster
        - team_services_ops

- grant:
    # Let cloudops manage the notify denylist to deal with bounces.
    - notify:manage-denylist
    # Allow cloudops to access tokens for clients that they manage.
    - auth:reset-access-token:project/releng/scriptworker/cloudops-canary
  to:
    - groups:
        - team_services_ops

##
# hook scopes

# this scope is included in the decision task's .scopes, and indicates which
# in-tree action hooks may be triggered for the taskgroup. We use this to limit
# the actions on a taskgraph to those at the appropriate level, preventing
# someone with level-3 access from being tricked into running a level-3 hook on
# a level-1 (try) push.
- grant:
    - in-tree:hook-action:project-{trust_domain}/in-tree-action-{level}-*
  to:
    - project:
        feature: gecko-actions
        job:
          - branch:*
          - cron:*
          - action:release-promotion

# control who can run generic actions: basically anyone at the project's
# level or higher. The backfill action is similarily unrestricted, but has
# a seperate action permision, to allow it to trigger actions.
- grant:
    - hooks:trigger-hook:project-gecko/in-tree-action-1-generic/*
    - hooks:trigger-hook:project-comm/in-tree-action-1-generic/*
    - hooks:trigger-hook:project-gecko/in-tree-action-1-backfill/*
    - hooks:trigger-hook:project-comm/in-tree-action-1-backfill/*
  to:
    - groups:
        - active_scm_level_1
        - active_scm_level_2
        - active_scm_level_3

- grant:
    - hooks:trigger-hook:project-gecko/in-tree-action-2-generic/*
    - hooks:trigger-hook:project-comm/in-tree-action-2-generic/*
    - hooks:trigger-hook:project-gecko/in-tree-action-2-backfill/*
    - hooks:trigger-hook:project-comm/in-tree-action-2-backfill/*
  to:
    - groups:
        - active_scm_level_2
        - active_scm_level_3

- grant:
    - hooks:trigger-hook:project-gecko/in-tree-action-3-generic/*
    - hooks:trigger-hook:project-comm/in-tree-action-3-generic/*
    - hooks:trigger-hook:project-gecko/in-tree-action-3-backfill/*
    - hooks:trigger-hook:project-comm/in-tree-action-3-backfill/*
  to:
    - groups:
        - active_scm_level_3
        - sheriff
        - perf_sheriff

# retriggering a decision requires a lot of scopes, so only sheriffs
# and releng can do it
- grant:
    - hooks:trigger-hook:project-gecko/in-tree-action-1-retrigger-decision/*
    - hooks:trigger-hook:project-comm/in-tree-action-1-retrigger-decision/*
    - hooks:trigger-hook:project-gecko/in-tree-action-2-retrigger-decision/*
    - hooks:trigger-hook:project-comm/in-tree-action-2-retrigger-decision/*
    - hooks:trigger-hook:project-gecko/in-tree-action-3-retrigger-decision/*
    - hooks:trigger-hook:project-comm/in-tree-action-3-retrigger-decision/*
  to:
    - groups:
        - sheriff
        - perf_sheriff


# In addition to the default scopes, retriggering a decision task requires
# the scopes of a decision task.  These differ per project, so we use some
# substitution to generate the correct values
- grant:
    - assume:repo:hg.mozilla.org/{repo_path}:branch:default
    - in-tree:hook-action:project-gecko/in-tree-action-{level}-*
  to:
    - projects:
        feature: gecko-actions
        job: action:retrigger-decision

# Similarly with purging caches
- grant:
    - hooks:trigger-hook:project-gecko/in-tree-action-1-purge-caches/*
    - hooks:trigger-hook:project-comm/in-tree-action-1-purge-caches/*
    - hooks:trigger-hook:project-gecko/in-tree-action-2-purge-caches/*
    - hooks:trigger-hook:project-comm/in-tree-action-2-purge-caches/*
    - hooks:trigger-hook:project-gecko/in-tree-action-3-purge-caches/*
    - hooks:trigger-hook:project-comm/in-tree-action-3-purge-caches/*
  to:
    - groups:
        - sheriff
        - perf_sheriff

# tooltool.mozilla-releng.net and tokens.mozilla-releng.net scopes

- grant:
    - project:releng:services/tooltool/api/download/public
  to:
    - groups:
        - active_scm_level_1
        - active_scm_level_2
        - active_scm_level_3
        - team_moco

- grant:
    - project:releng:services/tooltool/api/download/internal
    - project:releng:services/tooltool/api/download/public
  to:
    - groups:
        - team_moco

- grant:
    - project:releng:services/tooltool/api/download/public
    - project:releng:services/tooltool/api/upload/public
    - project:releng:services/tooltool/api/manage
  to:
    - groups:
        - tooltooleditor-public

- grant:
    - project:releng:services/tooltool/api/download/internal
    - project:releng:services/tooltool/api/upload/internal
    - project:releng:services/tooltool/api/manage
  to:
    - groups:
        - tooltooleditor-internal

- grant:
    - secrets:get:project/comm/*
    - secrets:set:project/comm/*
  to:
    - groups: thunderbird-releng


- grant:
    # Grant everyone with Try access the schedulerId taskcluster-ui, so they can
    # create tasks with the task-creator in the UI
    - queue:scheduler-id:taskcluster-ui
  to:
    - groups:
        - active_scm_level_1
        - active_scm_level_2
        - active_scm_level_3


# Allow bitbar to manage bitbar workers
- grant:
    - assume:worker-type:bitbar/*
    - queue:worker-id:bitbar-*
    - auth:create-client:bitbar/*
    - auth:delete-client:bitbar/*
    - auth:disable-client:bitbar/*
    - auth:enable-client:bitbar/*
    - auth:reset-access-token:bitbar/*
    - auth:update-client:bitbar/*
  to:
    - groups:
        - bitbar


# Allow MozillaOnline to create builds
# See https://bugzilla.mozilla.org/show_bug.cgi?id=1515990
# This should also grant
#   assume:project-admin:mozillaonline
# but that currently creates a dependency cylce (Bug 1531166) so
# that scope is granted directly, along side this one.
- grant:
    # These are public
    - secrets:get:project/taskcluster/gecko/hgfingerprint
    - secrets:get:project/taskcluster/gecko/hgmointernal
    # Allow access to dedicated worker-types
    - queue:create-task:highest:mozillaonline-1/*
    - queue:create-task:highest:mozillaonline-3/*
    # Allow acceess scopes worker caches
    - docker-worker:cache:mozillaonline-level-1-*
    - docker-worker:cache:mozillaonline-level-3-*
    # Allow access to private toolchains from mozilla-central
    - queue:get-artifact:project/gecko/*
    # Allow acess to API keys
    - secrets:get:project/releng/gecko/build/level-1/*
    # Allow access to public tooltool artifacts
    - docker-worker:relengapi-proxy:tooltool.download.public
    - project:releng:services/tooltool/api/download/public
    # Allow a sensible scheduler-id
    - queue:scheduler-id:mozillaonline-*
    # Allows cancelling tasks with that scheduler-id
    - queue:cancel-task:mozillaonline-*
    # Allow reruning tasks with that scheduler-id
    - queue:rerun-task:mozillaonline-*
  to:
    - groups:
        - mozillaonline

- grant:
    # Grant cloudops the ability to manage product-details secrets (Bug 1527571)
    - secrets:get:repo:github.com/mozilla-releng/product-details*
    - secrets:set:repo:github.com/mozilla-releng/product-details*
  to:
    - groups:
        - cloudops

- grant:
    # Grant security team access to secrets and artifacts for civet
    - secrets:get:project/civet/github-deploy-key
    - secrets:set:project/civet/github-deploy-key
    - queue:get-artifact:project/civet/*
  to:
    - groups:
        - civet-sec-inf

- grant:
    # Grant security team access to secrets and artifacts for updatebot
    - secrets:get:project/updatebot/*
    - secrets:set:project/updatebot/*
    - queue:get-artifact:project/updatebot/*
  to:
    - groups:
        - updatebot-sec-inf

- grant:
    # Grant mobile the ability to see and modify their secrets
    - secrets:get:project/mobile/*
    - secrets:set:project/mobile/*
    - secrets:get:project/gecko/level-any/firefox-android/*
    - secrets:set:project/gecko/level-any/firefox-android/*
  to:
    - groups:
        - mobile_releases
        - mobile_eng_ops
        - mobile_test_ops

# Code Coverage runtime roles
# Project https://github.com/mozilla/code-coverage
# The Heroku apps can:
# - trigger the code coverage repo hook
# - read their configuration in secrets
# - send report emails to admins
- grant:
    - notify:email:*
  to:
    - roles:
        - project:relman:code-coverage/runtime/testing
        - project:relman:code-coverage/runtime/production
- grant:
    - hooks:trigger-hook:project-relman/code-coverage-repo-testing
    - secrets:get:project/relman/code-coverage/runtime-testing
  to:
    - roles:
        - project:relman:code-coverage/runtime/testing
- grant:
    - hooks:trigger-hook:project-relman/code-coverage-repo-production
    - secrets:get:project/relman/code-coverage/runtime-production
  to:
    - roles:
        - project:relman:code-coverage/runtime/production

- grant:
    - hooks:trigger-hook:project-relman/code-coverage-repo-testing
    - hooks:trigger-hook:project-relman/code-coverage-cron-testing
    - hooks:trigger-hook:project-relman/code-coverage-cron-production
    - hooks:trigger-hook:project-relman/code-coverage-repo-production
    - hooks:trigger-hook:project-relman/code-coverage-crontrigger-testing
    - hooks:trigger-hook:project-relman/code-coverage-crontrigger-production
    - secrets:get:project/relman/code-coverage/*
    - secrets:set:project/relman/code-coverage/*
    - queue:create-task:lowest:code-coverage/bot
    - queue:create-task:lowest:code-coverage/bot-gcp
  to:
    - roles:
        - mozillians-group:code-coverage-developers

# Bug 1597646 - Grant access to secrets to code-review developers
# Bug 1608262 - Grant task creation rights with the code-review/bot worker types to code-review developers.
- grant:
    - secrets:get:project/relman/code-review/*
    - secrets:set:project/relman/code-review/*
    - queue:create-task:lowest:code-review/bot
  to:
    - group:
        - code-review-developers

# Bug 1534463: allow `vpn_hg_admin` group to access Mercurial related secrets
- grant:
    - secrets:set:project/taskcluster/gecko/hgfingerprint
    - secrets:set:project/taskcluster/gecko/hgmointernal
    - secrets:get:project/taskcluster/gecko/hgfingerprint
    - secrets:get:project/taskcluster/gecko/hgmointernal
  to:
    - groups:
        - vpn_hg_admin

# Code Analysis CI
- grant:
    # Allow code-review developers to create tasks directly
    - assume:repo:github.com/mozilla/code-review:pull-request
    # Allow code-review developers to trigger their hooks
    - hooks:trigger-hook:project-relman/code-review-*
  to:
    - group:
        - code-review-developers

# Code Review runtime roles
# Project https://github.com/mozilla/code-review
# The Heroku apps can:
# - read their configuration in secrets
# - send report emails to admins
# - trigger the bot hook
- grant:
    - notify:email:*
    - hooks:trigger-hook:project-gecko/in-tree-action-1-generic/*
  to:
    - roles:
        - project:relman:code-review/runtime/testing
        - project:relman:code-review/runtime/production
- grant:
    - secrets:get:project/relman/code-review/runtime-testing
    - hooks:trigger-hook:project-relman/code-review-testing
    - docker-worker:cache:code-review-testing-checkout
  to:
    - roles:
        - project:relman:code-review/runtime/testing
- grant:
    - secrets:get:project/relman/code-review/runtime-production
    - hooks:trigger-hook:project-relman/code-review-production
  to:
    - roles:
        - project:relman:code-review/runtime/production

# Non-Moco Sheriffs-basic
# contributors in the Sheriffs group that need:
# * retriggering and rerunning tasks on production trees
# * dashboard showing CI automation tasks waiting for getting a machine
- grant:
    - queue:rerun-task:gecko-level-*
  to:
    - group:
        - non-moco-sheriffs-basic


# Glean team should be able to rerun tasks for the Glean releases powered by TC
- grant:
    - hooks:trigger-hook:project-glean/in-tree-action-1-generic/*
    - hooks:trigger-hook:project-glean/in-tree-action-3-generic/*
  to:
    - group:
        - glean_team


# Bug 1604686: Token for gfx github sync, ability to set and get
- grant:
    - secrets:get:project/webrender-ci/wrupdater-github-token
    - secrets:set:project/webrender-ci/wrupdater-github-token
    - secrets:get:gecko/gfx-github-sync/token
    - secrets:set:gecko/gfx-github-sync/token
  to:
    - roles:
        - mozillians-group:webrender-ci

# Bug 1751132: Token for rlbox github sync, ability to set and get
- grant:
    - secrets:get:gecko/rlbox-github-sync/token
    - secrets:set:gecko/rlbox-github-sync/token
  to:
    - roles:
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|mh

# Bug 1917007: Secrets for afranchuk/process-top-crashes
- grant:
    - secrets:get:project/mozilla/process-top-crashes/ci
  to:
    - project:
        alias: process-top-crashes
        job: [action:*, branch:*, cron:*, pull-request:trusted, release:*]

- grant:
    - secrets:get:project/mozilla/process-top-crashes/*
    - secrets:set:project/mozilla/process-top-crashes/*
  to:
    - roles:
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|afranchuk

# Mappings from `mozilla-group`s to `project-releng:ci-group`s
# This indirection exists because modifying `mozilla-group`s requires
# access to the root credentials.
- grant:
    - assume:project:releng:ci-group:civet-sec-inf
  to:
    - roles:
        - mozillians-group:civet-sec-inf
- grant:
    - assume:project:releng:ci-group:updatebot-sec-inf
  to:
    - roles:
        - mozillians-group:updatebot-sec-inf
- grant:
    - assume:project:releng:ci-group:code-review-developers
  to:
    - roles:
        - mozillians-group:code-review-developers
- grant:
    - assume:project:releng:ci-group:mobile_releases
  to:
    - roles:
        - mozilla-group:mobile_releases
- grant:
    - assume:project:releng:ci-group:mobile_eng_ops
  to:
    - roles:
        - mozilla-group:mobile_eng_ops
- grant:
    - assume:project:releng:ci-group:mobile_test_ops
  to:
    - roles:
        - mozilla-group:mobile_test_ops
- grant:
    - assume:project:releng:ci-group:glean_team
  to:
    - roles:
        - mozillians-group:glean_team
- grant:
    - assume:project:releng:ci-group:team_moco
  to:
    - roles:
        - mozilla-group:team_moco
- grant:
    - assume:project:releng:ci-group:sheriff
  to:
    - roles:
        - mozilla-group:sheriff
- grant:
    - assume:project:releng:ci-group:perf_sheriff
  to:
    - roles:
        - mozilla-group:perf_sheriff
- grant:
    - assume:project:releng:ci-group:non-moco-sheriffs-basic
  to:
    - roles:
        - mozillians-group:non-moco-sheriffs-basic
- grant:
    - assume:project:releng:ci-group:team_taskcluster
  to:
    - roles:
        - mozilla-group:team_taskcluster
- grant:
    - assume:project:releng:ci-group:fxci_tc_admins
  to:
    - roles:
        - mozilla-group:fxci_tc_admins
- grant:
    - assume:project:releng:ci-group:team_services_ops
  to:
    - roles:
        - mozilla-group:team_services_ops
- grant:
    - assume:project:releng:ci-group:tooltooleditor-public
  to:
    - roles:
        - mozilla-group:tooltooleditor-public
- grant:
    - assume:project:releng:ci-group:tooltooleditor-internal
  to:
    - roles:
        - mozilla-group:tooltooleditor-internal
- grant:
    - assume:project:releng:ci-group:mozillaonline
  to:
    - roles:
        - mozillians-group:fennec-china-build
- grant:
    - assume:project:releng:ci-group:vpn_hg_admin
  to:
    - roles:
        - mozilla-group:vpn_hg_admin
- grant:
    - assume:project:releng:ci-group:thunderbird-sheriff
  to:
    - roles:
        # Geoff Lankow (https://bugzilla.mozilla.org/show_bug.cgi?id=1520433)
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|geoff
        # Magnus Melin (https://bugzilla.mozilla.org/show_bug.cgi?id=1605714)
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|mkmelin
        # Patrick Cloke (https://bugzilla.mozilla.org/show_bug.cgi?id=1595942)
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|clokep
        # Ian Neal (https://bugzilla.mozilla.org/show_bug.cgi?id=1595942)
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|iann_cvs
- grant:
    - assume:project:releng:ci-group:thunderbird-releng
  to:
    - roles:
        # Thunderbird release engineering, Corey Bryant manager - Bug 1921006
        - mozilla-group:thunderbird_releng
- grant:
    - assume:project:releng:ci-group:team_mozillaonline
  to:
    - roles:
        - mozilla-group:team_mozillaonline
- grant:
    - assume:project:releng:ci-group:engworkflow
  to:
    - roles:
        - mozillians-group:engworkflow
- grant:
    - assume:project:releng:ci-group:shipit_firefox
  to:
    - roles:
        - mozilla-group:shipit_firefox

# https://bugzilla.mozilla.org/show_bug.cgi?id=1659596
- grant:
    - hooks:trigger-hook:project-mobile/in-tree-action-1-generic/*
    - hooks:trigger-hook:project-mobile/in-tree-action-3-generic/*
  to:
    - roles:
        - mozillians-group:android-components-developers
- grant:
    - assume:project:releng:ci-group:perftest
  to:
    - roles:
        - mozilla-group:perftest

# The 'anonymous' role defines scopes that are allowed for *any* API call; on other
# words, these define public access.
- grant:
    - auth:current-scopes
    - auth:expand-scopes
    - auth:get-client:*
    - auth:get-role:*
    - auth:list-roles
    - github:get-badge:*
    - github:get-repository:*
    - github:latest-status:*
    - github:list-builds
    - hooks:get:*
    - hooks:list-hooks:*
    - hooks:list-last-fires:*
    - hooks:status:*
    - index:find-task:*
    - index:list-namespaces:*
    - index:list-tasks:*
    - purge-cache:all-purge-requests
    - purge-cache:purge-requests:*
    - queue:create-task:project:none
    - queue:get-artifact:public/*
    - queue:get-provisioner:*
    - queue:get-task:*
    - queue:get-worker-type:*
    - queue:get-worker:*
    - queue:list-artifacts:*
    - queue:list-dependent-tasks:*
    - queue:list-provisioners
    - queue:list-task-group:*
    - queue:list-worker-types:*
    - queue:list-workers:*
    - queue:pending-count:*
    - queue:status:*
    - secrets:list-secrets
    - worker-manager:get-worker-pool:*
    - worker-manager:get-worker:*
    - worker-manager:list-providers
    - worker-manager:list-worker-pool-errors:*
    - worker-manager:list-worker-pools
    - worker-manager:list-workers:*
  to:
    - roles:
        - anonymous

# These grants are directly to the mozilla-group roles as they need
# are the root of available scopes.
- grant:
    - assume:github-admin:*
    - assume:hook-id:*
    - assume:login-identity:*
    - assume:moz-tree:*
    - assume:mozillians-group:*
    - assume:mozillians-user:*
    - assume:project-admin:*
    - assume:project:*
    - assume:repo:*
    - assume:worker-pool:*
    - assume:worker-type:*
    - auth:*
    - docker-worker:*
    - generic-worker:*
    - github:*
    - hooks:*
    - in-tree:*
    - index:*
    - notify:*
    - project:*
    - purge-cache:*
    - queue:*
    - scheduler:*
    - secrets:*
    - worker-manager:*
    - worker:*
  to:
    - roles:
        - mozilla-group:team_relops
        - mozilla-group:releng
        - mozilla-group:fxci_tc_admins
- grant:
    - assume:github-admin:*
    - assume:hook-id:*
    - assume:login-identity:*
    - assume:moz-tree:*
    - assume:mozillians-group:*
    - assume:mozillians-user:*
    - assume:project-admin:*
    - assume:project:*
    - assume:repo:*
    - assume:worker-pool:*
    - assume:worker-type:*
    - auth:*
    - docker-worker:*
    - generic-worker:*
    - github:*
    - hooks:*
    - in-tree:*
    - index:*
    - notify:*
    - project:*
    - purge-cache:*
    - queue:*
    - scheduler:*
    - secrets:*
    - worker-manager:*
    - worker:*
  to:
    - roles:
        - mozilla-group:team_taskcluster
  environments: staging

# docker-worker AMI related: create tasks for every pool to see versions
- grant:
    - queue:create-task:low:*
  to:
    - roles:
        - mozilla-group:team_taskcluster

# Bug 1672397: Scopes to use Taskcluster notify service
- grant:
    - notify:email:perftest-alerts@mozilla.com
    - notify:email:dhunt@mozilla.com
    - notify:email:beatrice.acasandrei@softvision.com
  to:
    - roles:
        # Beatrice Acasandrei - Softvision Sheriff contributor
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|bacasandrei

# Bug 1738050: secret scopes to perftest
- grant:
    - secrets:set:project/perftest/*
    - secrets:get:project/perftest/*
  to:
    - roles:
        - mozilla-group:perftest

# Scopes for running Translations training cycles and debugging
- grant:
    - hooks:trigger-hook:project-translations/in-tree-action-*
    - hooks:trigger-hook:project-translations/in-tree-pr-action-*
    - queue:create-task:low:translations-1/*
    - docker-worker:cache:translations-level-1*
    - generic-worker:cache:translations-level-1*
    - queue:scheduler-id:taskcluster-ui
    - queue:cancel-task:taskcluster-ui/*
    # Note: these two scopes allow accessing these private artifacts on _any_ Task,
    # not just `translations` tasks. However, users receiving these grants can't
    # _create_ interactive tasks for any other projects (without also having other
    # scopes), so the risk here is low.
    - queue:get-artifact:private/interactive/*
    - queue:get-artifact:private/docker-worker/*
    - queue:get-artifact:private/generic-worker/*
    - secrets:get:project/translations/level-1/*
    - secrets:set:project/translations/level-1/*
  to:
    - roles:
        - mozillians-group:translations-developers

# Beetmover scopes for Translations
- grant:
    - project:translations:releng:beetmover:bucket:dep
  to:
    - project:
        alias:
          - translations
        job:
          - branch:*
          - pull-request:*

- grant:
    - project:translations:releng:beetmover:bucket:release
  to:
    - project:
        alias:
          - translations
        job:
          - branch:*

- grant:
    - project:translations:releng:beetmover:action:upload-translations-artifacts
  to:
    - project:
        alias:
          - translations
    - project:
        alias:
          - staging-firefox-translations-training

# allow bytesized to trigger nightly releases on pine
- grant:
    - hooks:trigger-hook:project-releng/cron-task-projects-pine/*
  to:
    - roles:
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|rsteuber
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|spohl
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|nalexander
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|mpohle
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|nrishel
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|nshukla

# allow mardak to trigger nightly releases on larch
- grant:
    - hooks:trigger-hook:project-releng/cron-task-projects-larch/*
  to:
    - roles:
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|elee

# allow desktop integrations team to manage the Limited Access Feature token
# used in Windows builds. Unlike other build secrets (like google API keys)
# these are tied to particular brandings (eg: unofficial, nightly, release),
# so we do not separate them by level.
- grant:
    - secrets:get:project/releng/gecko/build/windows-laf-tokens.data
    - secrets:set:project/releng/gecko/build/windows-laf-tokens.data
  to:
    - roles:
        - mozillians-group:windows-laf-token-managers

# mozilla/fx-desktop-qa-automation
- grant:
    - notify:slack-channel:*
    - queue:route:notify.slack-channel.*
  to:
    - project:
        alias:
          - fx-desktop-qa-automation

- grant:
    - secrets:get:project/mozilla/fx-desktop-qa-automation/level-*
    - secrets:set:project/mozilla/fx-desktop-qa-automation/level-*
  to:
    - roles:
        - login-identity:mozilla-auth0/ad|Mozilla-LDAP|bchatterton
